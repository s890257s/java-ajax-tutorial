# ç« ç¯€ 3 ï½œ å°ˆæ¥­ç´šå¾Œç«¯ API è¨­è¨ˆ (Professional Backend)

## <a id="toc"></a>ç›®éŒ„

- [3-1 ä»€éº¼æ˜¯ RESTful APIï¼Ÿ](#CH3-1)
- [3-2 è³‡æ–™å‚³è¼¸ç‰©ä»¶ (DTO) æ·±åº¦è§£æ](#CH3-2)
- [3-3 ç‰©ä»¶è½‰æ›ç¥å™¨ï¼šBeanUtils vs MapStruct](#CH3-3)
- [3-4 æ¥æ”¶è³‡æ–™çš„åå…«èˆ¬æ­¦è—](#CH3-4)

---

### åº

åœ¨èƒ½è·Ÿå‰ç«¯é †åˆ©æºé€šå¾Œï¼Œæˆ‘å€‘è¦æŠŠç„¦é»è½‰å›å¾Œç«¯ã€‚
å¯« API ä¸åªæ˜¯ã€Œèƒ½è·‘å°±å¥½ã€ï¼Œè€Œæ˜¯è¦å¯«å¾—ã€Œå®‰å…¨ã€å¥½ç¶­è­·ã€ã€‚é€™ç« æˆ‘å€‘è¦æ¢è¨å¾Œç«¯å·¥ç¨‹å¸«æœ€æ ¸å¿ƒçš„æŠ€èƒ½ï¼š**å¦‚ä½•è¨­è¨ˆå„ªé›…çš„è³‡æ–™æµ**ã€‚

---

## <a id="CH3-1"></a>[3-1 ä»€éº¼æ˜¯ RESTful APIï¼Ÿ](#toc)

å¾Œç«¯å·¥ç¨‹å¸«æœ€å¸¸è½åˆ°çš„è©å°±æ˜¯ **RESTful API**ã€‚å®ƒä¸æ˜¯ä¸€ç¨®ç¨‹å¼èªè¨€ï¼Œä¹Ÿä¸æ˜¯ä¸€ç¨®å”å®šï¼Œè€Œæ˜¯ä¸€ç¨® **ã€Œè»Ÿé«”æ¶æ§‹é¢¨æ ¼ã€ (Architectural Style)**ã€‚

REST å…¨å **Representational State Transfer** (è¡¨ç¾å±¤ç‹€æ…‹è½‰ç§»)ã€‚é€™ä¸‰å€‹å­—æ‹†é–‹ä¾†è§£é‡‹ï¼Œå°±èƒ½ç†è§£å®ƒçš„ç²¾é«“ï¼š

1.  **Representational (è¡¨ç¾å±¤ / è¡¨ç¾å½¢å¼)**

    - **è³‡æº (Resource)** æ˜¯ä¸€å€‹æŠ½è±¡æ¦‚å¿µ (ä¾‹å¦‚ï¼š`/api/users/1` é€™ä½ä½¿ç”¨è€…)ã€‚
    - **è¡¨ç¾å½¢å¼ (Representation)** å‰‡æ˜¯è³‡æºçš„å…·é«”å‘ˆç¾æ–¹å¼ã€‚åŒä¸€å€‹è³‡æºï¼Œå¯ä»¥æœ‰ä¸åŒçš„é•·ç›¸ï¼š

      ```json
      // JSON æ ¼å¼ (æœ€å¸¸ç”¨)
      { "id": 1, "name": "Alice", "role": "Admin" }
      ```

      ```xml
      <!-- XML æ ¼å¼ -->
      <user>
          <id>1</id>
          <name>Alice</name>
          <role>Admin</role>
      </user>
      ```

      ```html
      <!-- HTML æ ¼å¼ -->
      <div>
        <h1>Alice</h1>
        <p>Role: Admin</p>
      </div>
      ```

    - _é‡é»ï¼šServer å‚³çµ¦ä½ çš„ä¸æ˜¯ã€ŒAlice æœ¬äººã€ï¼Œè€Œæ˜¯ã€ŒAlice çš„è¡¨ç¾å½¢å¼ã€ã€‚_

2.  **State (ç‹€æ…‹)**

    - æŒ‡çš„æ˜¯è³‡æºåœ¨ç•¶ä¸‹çš„ã€Œè³‡æ–™å…§å®¹ã€ã€‚
    - æ¥çºŒä¸Šé¢çš„ä¾‹å­ï¼Œç•¶ä½ æ‹¿åˆ° Representation æ™‚ï¼Œä½ å°±æ“æœ‰äº†è©²è³‡æºçš„ **ç‹€æ…‹**ï¼š

      ```javascript
      /*
       ä»¥ä¸‹æ ¼å¼è¡¨é”ç‹€æ…‹
       id æ˜¯ 1
       å§“åæ˜¯ Alice
       è§’è‰²æ˜¯ Admin
       */
      {
        "id": 1,
        "name": "Alice",
        "role": "Admin"
      }
      ```

    - åŒæ™‚ä¹Ÿéš±å«äº† **Stateless (ç„¡ç‹€æ…‹)** çš„åŸå‰‡ï¼šServer ä¸æœƒè¨˜å¾—ã€Œä½ å‰›æ‰çœ‹é Aliceã€ã€‚æ¯æ¬¡è«‹æ±‚éƒ½æ˜¯ç¨ç«‹çš„ï¼Œä½ å¿…é ˆè‡ªå·±æŠŠç‹€æ…‹å¸¶çµ¦ Server (ä¾‹å¦‚èº«åˆ†è­˜åˆ¥çš„ Token)ã€‚

3.  **Transfer (è½‰ç§»)**

    - é€™æ˜¯ REST æœ€å®¹æ˜“è¢«å¿½ç•¥ï¼Œä½†ä¹Ÿæœ€æ ¸å¿ƒçš„æ¦‚å¿µã€‚
    - **å®šç¾©**ï¼šClient èˆ‡ Server ä¹‹é–“ï¼Œé€é HTTP Request / Responseï¼Œä¾†å›äº¤æ› Representation çš„éç¨‹ã€‚

    REST å¼·èª¿**ç³»çµ±ç‹€æ…‹ä¸æ˜¯é  Server çš„ Session ç¶­æŒï¼Œè€Œæ˜¯é ã€Œä¾†å›å‚³éã€é€æ­¥æ¨é€²**ã€‚é€™æ„å‘³è‘— Server æ²’æœ‰è¨˜æ†¶ï¼Œæ¯ä¸€æ¬¡è«‹æ±‚éƒ½æ˜¯ç¨ç«‹çš„ã€‚

    **èˆ‰å€‹ã€Œè¨‚å–®æµç¨‹ã€çš„ä¾‹å­ï¼š**

    - **â‘  Clientï¼šæˆ‘è¦çœ‹çœ‹è¨‚å–®**
      - Client: `GET /orders/123`
      - Server å›å‚³ Representation: `{ "id": 123, "status": "CREATED" }`
      - ğŸ‘‰ **Transfer #1**ï¼šClient ç²çŸ¥ç•¶å‰ç‹€æ…‹ç‚ºã€Œå·²å»ºç«‹ã€ã€‚
    - **â‘¡ Clientï¼šå¥½ï¼Œé‚£æˆ‘ä»˜æ¬¾**
      - Client: `POST /orders/123/payments`
      - Server å›å‚³ Representation: `{ "id": 123, "status": "PAID" }`
      - ğŸ‘‰ **Transfer #2**ï¼šClient ç²çŸ¥ç‹€æ…‹æ›´æ–°ç‚ºã€Œå·²ä»˜æ¬¾ã€ã€‚

    **ç‚ºä»€éº¼é€™æ¨£è¨­è¨ˆï¼Ÿ**

    - **å¯æ“´å…… (Scalable)**ï¼šå› ç‚º Server ä¸ç”¨è¨˜ä½ã€Œä½ èµ°åˆ°å“ªä¸€æ­¥ã€ï¼Œæ‰€ä»¥è«‹æ±‚å¯ä»¥ç”±ä»»æ„ä¸€å° Server è™•ç†ã€‚
    - **å¯å¿«å– (Cacheable)**ï¼šå› ç‚ºæ˜¯ç´”ç²¹çš„è³‡æºå‚³éï¼ŒGET è«‹æ±‚å¾ˆå®¹æ˜“è¢« CDN å¿«å–ã€‚

**ç¸½çµï¼š**
**REST = Client é€é HTTPï¼Œåè¦†å–å¾—è³‡æºçš„è¡¨ç¤º (Representation)ï¼Œé€æ­¥æ›´æ–°è‡ªå·±å°ç³»çµ±çš„ç‹€æ…‹ (State) ç†è§£ã€‚**

---

### 1. åŸºæœ¬ä»‹ç´¹ï¼šè³‡æº (Resources) èˆ‡ å‹•è© (Verbs)

åœ¨ RESTful çš„è¨­è¨ˆç†å¿µä¸­ï¼Œæˆ‘å€‘å°‡ç¶²è·¯ä¸Šçš„äº‹ç‰©æŠ½è±¡ç‚º **è³‡æº (Resource)**ã€‚è€Œè¨­è¨ˆ API æ™‚çš„æ ¸å¿ƒåŸå‰‡å°±æ˜¯ï¼šã€Œ**URL æ˜¯åè©ï¼ŒHTTP Method æ˜¯å‹•è©**ã€ã€‚

#### === URL åƒ…ä»£è¡¨è³‡æº (åè©)===

**URL (Uniform Resource Locator)** å°±åƒæ˜¯ç¶²è·¯ä¸Šçš„åœ°å€ï¼Œå®ƒæ‡‰è©²åªè² è²¬ã€Œå®šä½è³‡æºã€ï¼Œå› æ­¤ **åªèƒ½åŒ…å«åè©**ï¼Œä¸æ‡‰å‡ºç¾å‹•è©ã€‚

- âŒ **éŒ¯èª¤ç¤ºç¯„ (URL å«å‹•è©)**ï¼š

  - `/api/getAllUsers` (get ç‚ºå‹•è©)
  - `/api/create/user` (create ç‚ºå‹•è©ã€user ç‚ºå–®æ•¸)
  - `/api/users/update?id=1` (update ç‚ºå‹•è©)

- âœ… **æ­£ç¢ºç¤ºç¯„ (åƒ…å«åè©)**ï¼š
  - `/api/users` (ä»£è¡¨ä½¿ç”¨è€…é›†åˆ)
  - `/api/users/1` (ä»£è¡¨ç‰¹å®šä½¿ç”¨è€…è³‡æº)

#### === HTTP è«‹æ±‚æ–¹æ³• (HTTP Methods) - å®šç¾©å‹•è© ===

è¦å°è³‡æºé€²è¡Œä»€éº¼æ“ä½œï¼Œæ‡‰ç”± **HTTP å”å®šå®šç¾©çš„æ¨™æº–è«‹æ±‚æ–¹æ³•** ä¾†æ±ºå®šã€‚å¸¸è¦‹çš„æ–¹æ³•èˆ‡æ‡‰ç”¨å ´æ™¯å¦‚ä¸‹ï¼š

- **GET (è®€å–)**
  - **å®šç¾©**ï¼šè«‹æ±‚ç²å–æŒ‡å®šè³‡æºçš„è¡¨ç¤ºå½¢å¼ã€‚æ‡‰ç‚ºå®‰å…¨ä¸”å†ªç­‰ã€‚
  - **å ´æ™¯**ï¼šå–å¾—ä½¿ç”¨è€…åˆ—è¡¨ã€æŸ¥è©¢å–®ç­†è¨‚å–®è©³æƒ…ã€‚
- **POST (æ–°å¢)**
  - **å®šç¾©**ï¼šæäº¤å¯¦é«”ä»¥å»ºç«‹æ–°çš„è³‡æºã€‚
  - **å ´æ™¯**ï¼šè¨»å†Šæœƒå“¡ã€å»ºç«‹æ–°è¨‚å–®ã€ä¸Šå‚³æª”æ¡ˆã€‚
- **PUT (æ•´ç­†æ›¿æ›)**
  - **å®šç¾©**ï¼šç”¨è«‹æ±‚çš„ Payload **å®Œæ•´æ›¿æ›** ç›®æ¨™è³‡æº (All or Nothing)ã€‚
  - **å ´æ™¯**ï¼šæ›´æ–°ä½¿ç”¨è€…çš„ã€Œæ‰€æœ‰ã€è³‡æ–™ (è‹¥æŸäº›æ¬„ä½æ²’å‚³ï¼Œå¯èƒ½æœƒè¢«æ¸…ç©º)ã€‚
- **PATCH (éƒ¨åˆ†æ›´æ–°)**
  - **å®šç¾©**ï¼šå°è³‡æºé€²è¡Œ **éƒ¨åˆ†ä¿®æ”¹**ã€‚
  - **å ´æ™¯**ï¼šåªä¿®æ”¹å¯†ç¢¼ã€åªè®Šæ›´ç‹€æ…‹ (Active/Inactive)ã€‚
- **DELETE (åˆªé™¤)**
  - **å®šç¾©**ï¼šè«‹æ±‚ä¼ºæœå™¨åˆªé™¤æŒ‡å®šè³‡æºã€‚
  - **å ´æ™¯**ï¼šåˆªé™¤æ–‡ç« ã€ç§»é™¤æˆ‘çš„æœ€æ„›ã€‚

> **ğŸ“ å‚™è¨»ï¼šæ‰€æœ‰ HTTP Method ç°¡ä»‹**
>
> é™¤äº†ä¸Šè¿°å¸¸ç”¨çš„ CRUD æ–¹æ³•å¤–ï¼ŒHTTP 1.1 é‚„å®šç¾©äº†å…¶ä»–æ–¹æ³•ï¼š
>
> - **HEAD**
>   èˆ‡ GET å®Œå…¨ç›¸åŒï¼Œä½†**åªå›å‚³ Headerï¼Œä¸å›å‚³ Body**ã€‚å¸¸ç”¨æ–¼æª¢æŸ¥è³‡æºæ˜¯å¦å­˜åœ¨æˆ–æª¢æŸ¥ç‰ˆæœ¬ (Last-Modified)ã€‚
> - **OPTIONS**
>   è©¢å• Server å°è©²è³‡æºæ”¯æ´å“ªäº› Methodã€‚å¸¸ç”¨æ–¼ **CORS (è·¨ä¾†æºè³‡æºå…±äº«)** çš„é æª¢è«‹æ±‚ (Preflight Request)ã€‚
> - **TRACE**
>   å›å‚³ Server æ”¶åˆ°çš„è«‹æ±‚å…§å®¹ï¼Œç”¨æ–¼æ¸¬è©¦æˆ–è¨ºæ–· (ä½†æœ‰å®‰å…¨æ€§é¢¨éšªï¼Œé€šå¸¸æœƒé—œé–‰)ã€‚
> - **CONNECT**
>   å°‡é€£ç·šæ”¹ç‚º Tunnel æ¨¡å¼ï¼Œä¸»è¦ç”¨æ–¼ SSL/HTTPS ä»£ç†ä¼ºæœå™¨ã€‚

---

### 2. API å¯«æ³•ã€HTTP è«‹æ±‚èˆ‡èªæ„

RESTful é¢¨æ ¼å¼·èª¿ä½¿ç”¨ **HTTP Method (å‹•è©)** ä¾†è¡¨é”ä½ çš„æ„åœ– (CRUD)ï¼š

<table aria-label="HTTP è«‹æ±‚æ–¹æ³•èˆ‡æ“ä½œå°ç…§" class="table table-sm margin-top-none">
<thead>
<tr>
<th><strong>è³‡æº (Resource)</strong></th>
<th><strong>GET (æŸ¥è©¢)</strong><br><small>âœ… å†ªç­‰</small></th>
<th><strong>POST (æ–°å¢)</strong><br><small>âŒ éå†ªç­‰</small></th>
<th><strong>PUT (ç½®æ›)</strong><br><small>âœ… å†ªç­‰</small></th>
<th><strong>PATCH (ä¿®æ”¹)</strong><br><small>âŒ éå†ªç­‰</small></th>
<th><strong>DELETE (åˆªé™¤)</strong><br><small>âœ… å†ªç­‰</small></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/users</code></td>
<td>å–å¾—æ‰€æœ‰ä½¿ç”¨è€…</td>
<td>æ–°å¢ä¸€å€‹ä½¿ç”¨è€…</td>
<td>èªæ„éŒ¯èª¤</td>
<td>èªæ„éŒ¯èª¤</td>
<td>èªæ„éŒ¯èª¤</td>
</tr>
<tr>
<td><code>/users/{id}</code></td>
<td>å–å¾—æŒ‡å®š ID ä½¿ç”¨è€…</td>
<td>èªæ„éŒ¯èª¤</td>
<td>æ•´ç­†æ›¿æ›æŒ‡å®šè³‡æ–™</td>
<td>éƒ¨åˆ†æ›´æ–°æŒ‡å®šè³‡æ–™</td>
<td>åˆªé™¤æŒ‡å®š ID ä½¿ç”¨è€…</td>
</tr>
</tbody>
</table>

> **ğŸ“ å‚™è¨»ï¼šæ·±å…¥ç†è§£å†ªç­‰æ€§ (Idempotency)**
>
> **1. å®šç¾©**
> é€™æ˜¯ HTTP è¦ç¯„ä¸­çš„è¡“èªï¼Œæ„æ€æ˜¯ï¼šã€Œ**å°åŒä¸€ç­†è³‡æ–™é€²è¡Œä¸€æ¬¡äº¦æˆ–å¤šæ¬¡æ“ä½œï¼Œä¼ºæœå™¨çš„æœ€çµ‚ç‹€æ…‹æ‡‰è©²æ˜¯ç›¸åŒçš„**ã€ã€‚
>
> **2. ç‚ºä»€éº¼é€™å¾ˆé‡è¦ï¼Ÿ**
>
> - **æ±ºå®šèƒ½å¦ã€Œå®‰å…¨é‡è©¦ (Retry)ã€**ï¼šé€™æ˜¯å¯¦å‹™ä¸Šæœ€é‡è¦çš„ç”¨é€”ã€‚ç•¶ Client ç™¼å‡ºè«‹æ±‚ä½†å› ç¶²è·¯æ–·ç·šæ²’æ”¶åˆ°å›æ‡‰æ™‚ï¼š
>   - è‹¥æ˜¯ **å†ªç­‰** æ“ä½œ (å¦‚ `PUT`, `DELETE`)ï¼šClient å¯ä»¥æ”¾å¿ƒåœ°è‡ªå‹•é‡è©¦ï¼Œä¸ç”¨æ“”å¿ƒå‰¯ä½œç”¨ (ä¾‹å¦‚é‡è¤‡æ‰£æ¬¾)ã€‚
>   - è‹¥ **éå†ªç­‰** æ“ä½œ (å¦‚ `POST`)ï¼šçµ•å°ä¸èƒ½éš¨ä¾¿è‡ªå‹•é‡è©¦ï¼Œå¦å‰‡å¯èƒ½æœƒé€ æˆã€Œé‡è¤‡ä¸‹å–®ã€æˆ–ã€Œé‡è¤‡å»ºç«‹è³‡æ–™ã€çš„ç½é›£ã€‚
> - **å¿«å–æ©Ÿåˆ¶ (Caching)**ï¼šCDN æˆ–ç€è¦½å™¨åªæ•¢å°å†ªç­‰ä¸”å®‰å…¨çš„æ–¹æ³• (å¦‚ `GET`) åšå¿«å–ã€‚
>
> **3. ç¯„ä¾‹å°ç…§**
>
> - âœ… **å†ªç­‰ (`DELETE /users/1`)**ï¼šç¬¬ä¸€æ¬¡è«‹æ±‚åˆªé™¤æˆåŠŸï¼›ç¬¬äºŒæ¬¡è«‹æ±‚é›–æœƒå›å‚³ 404 (Not Found)ï¼Œä½†è³‡æ–™åº«ã€Œæ²’æœ‰è©²ä½¿ç”¨è€…ã€çš„**ç‹€æ…‹**ç¶­æŒä¸è®Šã€‚
> - âŒ **éå†ªç­‰ (`POST /users`)**ï¼šæ¯æ¬¡è«‹æ±‚éƒ½æœƒã€Œæ–°å¢ã€ä¸€ç­†å…¨æ–°çš„è³‡æ–™ (Id 1, Id 2, ...)ï¼Œæ”¹è®Šäº†ä¼ºæœå™¨çš„ç‹€æ…‹ã€‚
>
> **4. ç‚ºä»€éº¼ PATCH ä¸æ˜¯å†ªç­‰ï¼Ÿ**
> é›–ç„¶åªæ˜¯æ”¹æ¬„ä½ï¼Œçœ‹èµ·ä¾†å¾ˆåƒå†ªç­‰ï¼Œä½† HTTP å”å®šå…è¨± PATCH åŒ…å«ã€Œæ“ä½œæŒ‡ä»¤ã€è€Œä¸åƒ…æ˜¯æ•¸æ“šã€‚
>
> - **å ´æ™¯ A (åƒå†ªç­‰)**ï¼š`{ "email": "new@example.com" }` -> é‡è©¦ N æ¬¡çµæœéƒ½ä¸€æ¨£ (Email éƒ½æ˜¯æ–°çš„)ã€‚
> - **å ´æ™¯ B (éå†ªç­‰)**ï¼š`{ "operation": "add", "value": 100 }` (å¦‚å¢åŠ é¤˜é¡) -> é‡è©¦ N æ¬¡æœƒå°è‡´é¤˜é¡é‡è¤‡å¢åŠ ã€‚
>
> å› ç‚º PATCH å…è¨±å ´æ™¯ B çš„å­˜åœ¨ï¼Œæ‰€ä»¥è¦ç¯„å°‡å…¶å®šç¾©ç‚º **éå†ªç­‰**ï¼Œç€è¦½å™¨èˆ‡ CDN ä¹Ÿä¸æœƒå°å…¶é€²è¡Œè‡ªå‹•é‡è©¦æˆ–å¿«å–ã€‚

> **ğŸ’¡ æ€è€ƒç·´ç¿’ï¼šè©²æ€éº¼ç‚ºã€Œçµå¸³ (Checkout)ã€API å‘½åï¼Ÿ**
>
> å‡è¨­ä½ è¦è¨­è¨ˆä¸€å€‹ APIï¼Œè®“æœƒå“¡ ID=1 é€²è¡Œè³¼ç‰©è»Šçµå¸³ä»˜æ¬¾ã€‚ç›´è¦ºä¸Šä½ å¯èƒ½æœƒæƒ³ç”¨å‹•è©ï¼š
>
> - âŒ **ç›´è¦ºæƒ³æ³•**ï¼š`POST /users/1/pay` æˆ– `POST /checkout`
> - **å•é¡Œé»**ï¼šREST é¢¨æ ¼ä¸å–œæ­¡å‹•è©å‡ºç¾åœ¨ URLã€‚
>
> **RESTful çš„æ‹†è§£æ€è·¯**ï¼š
> ã€Œçµå¸³ã€é€™å€‹å‹•ä½œï¼Œå…¶å¯¦æœ¬è³ªä¸Šå°±æ˜¯ã€Œå»ºç«‹äº†ä¸€ç­†è¨‚å–®ã€ã€‚æ‰€ä»¥æˆ‘å€‘æ‡‰è©²æŠŠé‡é»æ”¾åœ¨ç”¢ç”Ÿçš„**è³‡æº (Resource)** ä¸Šã€‚
>
> - âœ… **æ­£ç¢ºè§£ç­”**ï¼š`POST /users/1/orders`
> - **èªæ„**ï¼šå°ä½¿ç”¨è€… 1 æ–°å¢ä¸€ç­†è¨‚å–®è³‡æº (Create Order)ã€‚é€™æ¨£æ—¢ç¬¦åˆ REST çš„åè©è¦ç¯„ï¼Œä¹Ÿæ¸…æ¥šè¡¨é”äº†æ¥­å‹™å«ç¾©ã€‚

---

### 3. çµæ§‹åµŒå¥— (Nesting)

RESTful çš„ URL **ä¸æ˜¯åœ¨æè¿°å‹•ä½œï¼Œè€Œæ˜¯åœ¨æè¿°ã€Œè³‡æºä¹‹é–“çš„é—œä¿‚ã€**ã€‚æ‰€è¬‚çµæ§‹åµŒå¥— (Nested Resources)ï¼Œå°±æ˜¯**æŠŠå­è³‡æºæ›åœ¨çˆ¶è³‡æºä¹‹ä¸‹ï¼Œç”¨ URL éšå±¤è¡¨é”ã€Œå¾å±¬é—œä¿‚ã€**ã€‚

#### === æ ¸å¿ƒæ¦‚å¿µï¼šURL å°±åƒè³‡æ–™å¤¾ ===

æŠŠ URL æƒ³åƒæˆæª”æ¡ˆç¸½ç®¡çš„è³‡æ–™å¤¾çµæ§‹ï¼š

- `/users/42/orders` -> åœ¨ `users` è³‡æ–™å¤¾è£¡çš„ `42` è™Ÿè³‡æ–™å¤¾è£¡çš„ `orders` è³‡æ–™å¤¾ã€‚
- èªæ„ç¿»è­¯ï¼š**ã€Œ42 è™Ÿä½¿ç”¨è€…çš„è¨‚å–®åˆ—è¡¨ã€**ã€‚

ä¸æ˜¯åœ¨èªªã€Œæˆ‘è¦åšä»€éº¼ã€ï¼Œè€Œæ˜¯åœ¨èªªã€Œ**é€™å€‹æ±è¥¿å±¬æ–¼èª°**ã€ã€‚

#### === å…¸å‹ç¯„ä¾‹ ===

**Type Aï¼šä¸€å°å¤š (æœ€å¸¸è¦‹)**
é‡é»åœ¨æ–¼è³‡æºçš„æ­¸å±¬ã€‚

- `GET /users/42/orders` (å–å¾— 42 çš„æ‰€æœ‰è¨‚å–®)
- `POST /users/42/orders` (å¹« 42 æ–°å¢ä¸€å¼µè¨‚å–®)

**Type Bï¼šå¼·å¾å±¬é—œä¿‚ (å­è³‡æºç„¡æ³•ç¨ç«‹å­˜åœ¨)**

- `GET /orders/99/items` (å–å¾— 99 è™Ÿè¨‚å–®çš„æ˜ç´°)
- _Item é›¢é–‹ Order å°±æ²’æœ‰æ„ç¾©ï¼Œä¸” `/items/123` å–®ç¨å­˜åœ¨å¾ˆæ€ªï¼Œæ‰€ä»¥éå¸¸é©åˆåµŒå¥—ã€‚_

**Type Cï¼šå¤šå±¤åµŒå¥— (Deep Nesting)**

- `GET /companies/3/departments/7/employees`
- èªæ„æ¸…æ¥šï¼Œä½† **âš ï¸ å»ºè­°ä¸è¦è¶…é 2~3 å±¤**ï¼Œä»¥å… URL éé•·é›£ä»¥ç¶­è­·ã€‚

#### ä»€éº¼æ™‚å€™ã€Œä¸è©²ã€åµŒå¥—ï¼Ÿ

**âŒ éŒ¯èª¤ 1ï¼šå­è³‡æºå…¶å¯¦æ˜¯ç¨ç«‹æ¦‚å¿µ**

- `POST /users/42/products`
- å¦‚æœ `Product` æ˜¯å…¨ç«™å…±ç”¨çš„å•†å“ï¼Œä¸æ‡‰è©²éš¸å±¬æ–¼ Userã€‚æ‡‰è©²ç”¨ `/products`ã€‚

**âŒ éŒ¯èª¤ 2ï¼šæŠŠã€ŒæŸ¥è©¢æ¢ä»¶ã€ç•¶æˆçµæ§‹**

- `GET /orders/2024/paid`
- ã€Œ2024ã€å’Œã€Œpaidã€å…¶å¯¦æ˜¯ç¯©é¸æ¢ä»¶ï¼Œä¸æ˜¯å¾å±¬è³‡æºã€‚
- âœ… æ­£ç¢ºï¼š`GET /orders?year=2024&status=paid`

#### === è¨­è¨ˆåˆ¤æ–·æ³• ===

å¦‚æœä¸ç¢ºå®šè©²ä¸è©²åµŒå¥—ï¼Œå•è‡ªå·±ä¸‰å€‹å•é¡Œï¼š

1.  **å­è³‡æºèƒ½ä¸èƒ½é›¢é–‹çˆ¶è³‡æºç¨ç«‹å­˜åœ¨ï¼Ÿ**
    _OrderItem é›¢é–‹ Order å°±æ²’æœ‰æ„ç¾©ï¼Œè¦åµŒå¥— âœ…ã€‚_
2.  **é€™å€‹ URL æ˜¯åœ¨æè¿°é—œä¿‚ï¼Œé‚„æ˜¯åœ¨æè¿°æ¢ä»¶ï¼Ÿ**
    _ã€Œå±¬æ–¼æŸäººçš„ã€æ˜¯é—œä¿‚ï¼Œè¦åµŒå¥— âœ…ï¼›ã€Œæ˜¯ä»Šå¹´çš„ã€æ˜¯æ¢ä»¶ï¼Œä¸åµŒå¥— âŒï¼Œè«‹ç”¨ Query Stringã€‚_
3.  **å¦‚æœæˆ‘åªçµ¦å­è³‡æº IDï¼Œèªæ„é‚„å®Œæ•´å—ï¼Ÿ**
    _å•†å“ ID å…¨åŸŸå”¯ä¸€ï¼Œç›´æ¥ `/products/1` å°±èƒ½å®šä½ï¼Œä¸ä¸€å®šè¦æ›åœ¨åˆ†é¡ä¸‹ï¼Œä¸åµŒå¥— âŒã€‚_

> **ğŸ’¡ å¯¦ä½œæé†’ï¼šURL æ˜¯èªæ„ï¼Œä¸æ˜¯ç¨‹å¼çµæ§‹**
>
> é›–ç„¶ URL æ˜¯ `/users/42/orders`ï¼Œä½†ä¸ä»£è¡¨ä½ å¾Œç«¯ä¸€å®šè¦å¯«ä¸€å€‹ `UserOrderController`ã€‚
> ä½ å®Œå…¨å¯ä»¥ç”¨ `OrderController` æ¥æ”¶ `userId` åƒæ•¸ã€‚**URL æ˜¯è¨­è¨ˆçµ¦ä½¿ç”¨è€…çœ‹çš„èªæ„ï¼Œä¸ä»£è¡¨ç¶æ­»å¾Œç«¯çš„å¯¦ä½œçµæ§‹ã€‚**

> **ğŸ’¡ æ·±åº¦æ€è€ƒï¼šè¨‚å–®è·Ÿæœƒå“¡ä¸€å®šè¦åµŒå¥—å—ï¼Ÿ**
>
> é€™æ˜¯åˆå­¸è€…å¸¸å•çš„å•é¡Œï¼šã€Œè¨‚å–®æ˜æ˜æœ‰å”¯ä¸€çš„ Order IDï¼Œç‚ºä»€éº¼é‚„è¦æ›åœ¨ User åº•ä¸‹ï¼Ÿã€
>
> **çµè«–ï¼šå•†æ¥­èªæ„ä¸Šã€Œä¸å¯ã€ç¨ç«‹ï¼Œä½†æŠ€è¡“å¯¦ä½œä¸Šã€Œå¯ä»¥ã€ç¨ç«‹ã€‚**
>
> 1.  **å¾èªæ„å±¤é¢ä¾†çœ‹**ï¼š
>     è¨‚å–®ä¸æœƒæ†‘ç©ºå‡ºç¾ï¼Œä¸€å®šæ­¸å±¬æ–¼æŸå€‹æœƒå“¡ã€‚
>     ä½¿ç”¨ `/users/{uid}/orders/{oid}` å¯ä»¥å¼·èª¿é€™ç¨®ã€Œå¾å±¬é—œä¿‚ã€ï¼Œä¸¦ä¸”è‡ªå¸¶ã€Œæ¬Šé™ç¯„åœã€çš„æš—ç¤ºï¼ˆåªèƒ½æŸ¥è©²ä½¿ç”¨è€…çš„ï¼‰ã€‚**é©åˆå‰å° App ä½¿ç”¨ã€‚**
>
> 2.  **å¾æŠ€è¡“å±¤é¢ä¾†çœ‹**ï¼š
>     è³‡æ–™åº«è£¡ `order_id` é€šå¸¸æ˜¯ Primary Keyï¼Œå…¨åŸŸå”¯ä¸€ã€‚æ‰€ä»¥ `/orders/{oid}` çµ•å°èƒ½åœ¨ DB æ’ˆåˆ°è³‡æ–™ã€‚
>     **é©åˆå¾Œå°ç®¡ç†å“¡ã€å®¢æœç³»çµ±ä½¿ç”¨**ï¼ˆå› ç‚ºå®¢æœä¸åœ¨ä¹æ˜¯èª°ä¸‹çš„ï¼Œä»–åªè¦æŸ¥é€™å¼µå–®ï¼‰ã€‚
>
> **æ‡¶äººåˆ¤æ–·è¡¨**ï¼šçœ‹ä½ çš„ API æ˜¯çµ¦èª°ç”¨çš„ã€‚
>
> - **çµ¦æœƒå“¡ç”¨ (å­˜å–è‡ªå·±)**ï¼šâœ… æ¨è–¦åµŒå¥— `/users/{id}/orders` (èªæ„æ¸…æ¥šã€æ¬Šé™æ˜ç¢º)ã€‚
> - **çµ¦ç®¡ç†å“¡ (æ‰¹æ¬¡ç®¡ç†)**ï¼šâŒ ä¸éœ€è¦åµŒå¥—ï¼Œç›´æ¥ `/orders/{id}` æˆ– `/orders` (æ–¹ä¾¿å¿«é€ŸæŸ¥è©¢)ã€‚

---

### 4. æŸ¥è©¢åƒæ•¸è¨­è¨ˆ (Filtering, Sorting, Pagination)

åœ¨ RESTful API ä¸­ï¼Œ**æŸ¥è©¢æ¢ä»¶é€šå¸¸æ”¾åœ¨ URL çš„ Query String**ï¼Œç”¨ä¾†æè¿°ã€Œ**æˆ‘è¦æ‰¾å“ªäº›è³‡æºã€ç”¨ä»€éº¼æ¢ä»¶æ‰¾**ã€ã€‚

#### === æ ¸å¿ƒæ¦‚å¿µï¼šPath vs Query ===

REST çš„è¨­è¨ˆå“²å­¸å°‡ URL åˆ†ç‚ºå…©å€‹éƒ¨åˆ†ï¼Œè·è²¬å¿…é ˆåˆ†æ¸…æ¥šï¼š

| éƒ¨åˆ†      | ç”¨é€”                     | ç¯„ä¾‹                              |
| :-------- | :----------------------- | :-------------------------------- |
| **Path**  | **å®šä½è³‡æº (Resource)**  | `/api/users` (æˆ‘è¦æ‰¾ User)        |
| **Query** | **ç¯©é¸æ¢ä»¶ (Condition)** | `?status=active` (æˆ‘è¦æ‰¾å•Ÿç”¨ä¸­çš„) |

- âœ… **æ­£ç¢º**ï¼š`GET /api/users?status=active` (ç¯©é¸ User é›†åˆ)
- âŒ **éŒ¯èª¤**ï¼š`/api/users/active` (active åƒæ˜¯è³‡æºçš„ä¸€ç¨®ï¼Ÿå®¹æ˜“æ··æ·†)

> **ğŸ’¡ éš¨å ‚æ¸¬é©—ï¼šå¦‚æœè¦æ‰¾ã€Œå¹´é½¡å¤§æ–¼ 30 æ­²ã€çš„ä½¿ç”¨è€…ï¼Ÿ**
>
> âŒ **éŒ¯èª¤è¨­è¨ˆ**ï¼š`/api/users/age/gt/30` (æŠŠé‹ç®—é‚è¼¯å¯«é€²è·¯å¾‘ï¼Œé›–ç„¶çœ‹å¾—æ‡‚ï¼Œä½†ä¸ç¬¦åˆ Restful é¢¨æ ¼)ã€‚
>
> âœ… **æ­£ç¢ºæ€è·¯**ï¼šQuery String æ‰æ˜¯æ”¾æ¢ä»¶çš„åœ°æ–¹ã€‚é›–ç„¶ REST æ²’æœ‰è¦å®šé‹ç®—å­æ€éº¼å¯«ï¼Œä½†å¸¸è¦‹æœ‰ï¼š
>
> - `?ageGt=30` (ç›´ç™½)
> - `?minAge=30` (èªæ„æ¸…æ¥š)

#### === å¸¸è¦‹æŸ¥è©¢é¡å‹ ===

**A. ç¯©é¸ (Filtering)**
æœ€åŸºæœ¬æ¬¾ï¼Œç›´æ¥ç”¨æ¬„ä½åç¨±ç•¶ Keyã€‚

- `GET /users?role=admin`
- `GET /products?category=book&inStock=true`

**B. åˆ†é  (Pagination)**
**é€™æ˜¯ REST åŸºæœ¬æŠ€èƒ½**ï¼Œçµ•å°ä¸è¦ä¸€æ¬¡æ’ˆå…¨éƒ¨è³‡æ–™å›å‚³ã€‚

- **Page/Size æ¨¡å¼**ï¼š`GET /posts?page=1&size=20` (ç¬¬ 1 é ï¼Œæ¯é  20 ç­†)
- **Offset/Limit æ¨¡å¼**ï¼š`GET /posts?offset=0&limit=20` (è·³é 0 ç­†ï¼ŒæŠ“ 20 ç­†)

**C. æ’åº (Sorting)**

- `GET /users?sort=createdAt,desc`
- `GET /users?sortBy=createdAt&order=desc` (å¦ä¸€ç¨®å¸¸è¦‹å¯«æ³•)

**D. æœå°‹ (Search / Keyword)**
é€šå¸¸ç”¨æ–¼æ¨¡ç³ŠæŸ¥è©¢æˆ–è·¨æ¬„ä½æœç´¢ã€‚

- `GET /articles?q=spring`
- `GET /products?keyword=iphone`

**E. ç¯„åœ (Range)**
å¸¸è¦‹æ–¼æ™‚é–“ã€é‡‘é¡ã€‚

- `GET /orders?minPrice=1000`
- `GET /logs?from=2025-01-01&to=2025-01-31`

#### === RESTful çš„å®Œæ•´ç¯„ä¾‹ ===

å°‡ä¸Šè¿°çµ„åˆèµ·ä¾†ï¼Œä¸€å€‹å„ªé›…çš„ API å‘¼å«æ‡‰è©²é•·é€™æ¨£ï¼š

```http
GET /api/orders?status=PAID&from=2025-01-01&sort=createdAt&order=desc&page=0&size=20
```

> **ç¿»è­¯ç™½è©±æ–‡ï¼š**
> ã€Œæˆ‘è¦æŸ¥ **Orders (è³‡æº)**ï¼Œæ¢ä»¶æ˜¯ **å·²ä»˜æ¬¾ä¸” 1 æœˆä»½ (ç¯©é¸)**ï¼ŒæŒ‰ **å»ºç«‹æ™‚é–“å€’åº (æ’åº)**ï¼Œçµ¦æˆ‘ **ç¬¬ 1 é çš„ 20 ç­†è³‡æ–™ (åˆ†é )**ã€‚ã€

#### === å¸¸è¦‹åæ¨¡å¼ (Anti-patterns) ===

- âŒ **ç”¨ POST ä¾†æŸ¥è©¢**ï¼š`POST /api/users/search` (é™¤éæ¢ä»¶é•·åˆ° URL å¡ä¸ä¸‹ï¼Œå¦å‰‡è«‹ç”¨ GETï¼Œå› ç‚º POST ä¸èƒ½è¢« Cache)ã€‚
- âŒ **æŠŠæŸ¥è©¢æ¢ä»¶å¡é€² Path**ï¼š`/api/users/age/30` (è®“äººæä¸æ¸… age æ˜¯è³‡æºé‚„æ˜¯æ¢ä»¶)ã€‚
- âŒ **å‹•è©å‹ Query**ï¼š`?getActive=true` (REST åå¥½åè©èˆ‡ç‹€æ…‹ï¼Œä¸è¦å¯«æˆç¨‹å¼ç¢¼ function åç¨±)ã€‚

> **ğŸ’¡ ä»€éº¼æ˜¯åæ¨¡å¼ (Anti-pattern)ï¼Ÿ**
> åæ¨¡å¼æ˜¯æŒ‡åœ¨è»Ÿé«”å·¥ç¨‹ä¸­ï¼Œé‚£äº›çœ‹ä¼¼ç›´è¦ºã€è¢«å»£æ³›ä½¿ç”¨ï¼Œä½†å¯¦éš›ä¸Šæœƒå°è‡´ç¶­è­·å›°é›£ã€æ•ˆèƒ½ä½ä¸‹æˆ–é•åæ¨™æº–å”å®šçš„è¨­è¨ˆæ–¹å¼ã€‚åœ¨ RESTful API çš„ä¸–ç•Œè£¡ï¼Œé¿é–‹åæ¨¡å¼æ˜¯ç‚ºäº†ç¢ºä¿ API çš„**ä¸€è‡´æ€§**ã€**å¯å¿«å–æ€§**èˆ‡**èªç¾©åŒ–**ï¼Œè®“ä»‹é¢æ›´å…·å‚™å¯é æ¸¬æ€§ã€‚

---

### 5. ç‰ˆæœ¬æ§åˆ¶

API ä¸€æ—¦ç™¼å¸ƒçµ¦åˆ¥äººç”¨ï¼Œå°±ä¸èƒ½éš¨ä¾¿æ”¹ï¼Œå¦å‰‡ä¾è³´ä½ çš„å‰ç«¯æˆ– APP æœƒå£æ‰ã€‚ç•¶æœ‰ã€Œç ´å£æ€§æ›´æ–°ã€æ™‚ï¼Œå¿…é ˆå‡ç´šç‰ˆæœ¬ã€‚
å¸¸è¦‹åšæ³•æœ‰å…©ç¨®ï¼š

1.  **URI Versioning (æœ€å¸¸è¦‹)**ï¼šç›´æ¥å¯«åœ¨è·¯å¾‘è£¡ã€‚
    - `/api/v1/users`
    - `/api/v2/users`
2.  **Header Versioning**ï¼šå¯«åœ¨ HTTP Header è£¡ (è¼ƒéš±æ™¦ï¼Œä½† URL ä¹¾æ·¨)ã€‚
    - Header: `Accept-version: v1`

---

### 6. HTTP ç‹€æ…‹ç¢¼ (Status Codes)

æ­£ç¢ºä½¿ç”¨ç‹€æ…‹ç¢¼æ˜¯å¾Œç«¯å·¥ç¨‹å¸«çš„åŸºæœ¬ç´ é¤Šã€‚å°‡ç‹€æ…‹ç¢¼è¡¨æ ¼åŒ–æ•´ç†å¦‚ä¸‹ï¼š

#### 1xx (è³‡è¨Šå›æ‡‰ - Information)

é€šå¸¸ç”±åº•å±¤å”è­°è‡ªå‹•è™•ç†ï¼Œæ‡‰ç”¨å±¤è¼ƒå°‘ç›´æ¥æ“ä½œã€‚

| ä»£ç¢¼    | å®šç¾©                | ä¸­æ–‡     | æƒ…å¢ƒèªªæ˜                                                  |
| :------ | :------------------ | :------- | :-------------------------------------------------------- |
| **100** | Continue            | ç¹¼çºŒ     | Server å…è¨±ä½ ç¹¼çºŒå‚³é€ Body (é€šå¸¸ç”¨æ–¼å¤§æª”æ¡ˆä¸Šå‚³å‰çš„ç¢ºèª)ã€‚ |
| **101** | Switching Protocols | åˆ‡æ›å”å®š | ä¾‹å¦‚ HTTP å‡ç´šç‚º WebSocketã€‚                              |

#### 2xx (æˆåŠŸ - Success)

| ä»£ç¢¼    | å®šç¾©       | ä¸­æ–‡     | æƒ…å¢ƒèªªæ˜                                                                                              |
| :------ | :--------- | :------- | :---------------------------------------------------------------------------------------------------- |
| **200** | OK         | è«‹æ±‚æˆåŠŸ | **é€šç”¨æ¨™æº–æˆåŠŸå›æ‡‰**ï¼Œé€šå¸¸ç”¨æ–¼ GET æŸ¥è©¢ã€PUT ä¿®æ”¹ã€‚                                                   |
| **201** | Created    | å·²å»ºç«‹   | **è³‡æºå»ºç«‹æˆåŠŸ**ï¼Œé€šå¸¸ç”¨æ–¼ POSTã€‚<br>ğŸ’¡ _å»ºè­°åœ¨ Header å›å‚³ `Location` å‘ŠçŸ¥æ–°è³‡æºä½ç½®ã€‚_              |
| **202** | Accepted   | å·²æ¥å—   | **è«‹æ±‚å·²æ¥å—**ï¼Œä½†å°šæœªè™•ç†å®Œæˆã€‚<br>ğŸ’¡ _æƒ…å¢ƒï¼šéåŒæ­¥ä»»å‹™ (å¦‚åŒ¯å‡ºå ±è¡¨)ï¼Œå‰ç«¯éœ€è¼ªè©¢ (Polling) çµæœã€‚_   |
| **204** | No Content | ç„¡å…§å®¹   | **åŸ·è¡ŒæˆåŠŸ**ï¼Œä½†æ²’æœ‰å…§å®¹éœ€å›å‚³ã€‚<br>ğŸ’¡ _æƒ…å¢ƒï¼šDELETE åˆªé™¤æˆåŠŸï¼Œæˆ– PUT æ›´æ–°æˆåŠŸï¼Œä½†ä¸æƒ³å›å‚³ Payloadã€‚_ |

#### 3xx (é‡å°å‘ - Redirection)

| ä»£ç¢¼    | å®šç¾©               | ä¸­æ–‡       | æƒ…å¢ƒèªªæ˜                                                                                                                                                                                |
| :------ | :----------------- | :--------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **301** | Moved Permanently  | æ°¸ä¹…ç§»å‹•   | **æ°¸ä¹…æ€§æ¬å®¶ï¼Œmethod å¯èƒ½è¢«æ”¹ç‚º GET**ã€‚é€™å€‹ URL ä»¥å¾Œéƒ½ä¸ç”¨ä¾†äº†ï¼Œè«‹è¨˜ä½æ–°å®¶ã€‚SEO æ¬Šé‡(ç´¯ç©è©•åƒ¹)æœƒè½‰ç§»è‡³æ–°ç¶²å€ã€‚ç€è¦½å™¨æœƒã€Œç„¡æœŸé™ã€å¿«å–æ–°ç¶²å€ï¼Œä¸‹æ¬¡é€£èˆŠç¶²å€æ™‚æœƒè‡ªå‹•è·³è½‰ï¼Œä¸å†è©¢å• Serverã€‚ |
| **302** | Found              | å°‹æ‰¾       | **æš«æ™‚æ€§æ¬å®¶ (èªæ„æ¨¡ç³Š)**ã€‚è³‡æºæš«æ™‚æ›åœ°æ–¹ï¼Œä½†èˆŠç¶²å€ä¿ç•™ã€‚SEO æ¬Šé‡ä¸è½‰ç§»ã€‚ç€è¦½å™¨é€šå¸¸ä¸å¿«å–ã€‚<br>âš ï¸ _é™·é˜±ï¼šé›–è¦ç¯„èªªæ‡‰ç¶­æŒ Methodï¼Œä½†ç€è¦½å™¨å¯¦ä½œå¸¸æŠŠ POST æ”¹ç‚º GETã€‚_                       |
| **303** | See Other          | æŸ¥çœ‹å…¶ä»–   | **æ˜ç¢ºè¦æ±‚æ”¹ç”¨ GET å–å¾—çµæœ**ã€‚é€šå¸¸ç”¨æ–¼ Forms POST æäº¤å¾Œï¼Œç‚ºäº†é¿å…ä½¿ç”¨è€…ã€ŒF5 é‡æ–°æ•´ç†ã€é€ æˆé‡è¤‡é€å–®ï¼Œè€Œå°å‘åˆ°ä¸€å€‹ã€Œå®Œæˆé é¢ã€ã€‚                                                        |
| **304** | Not Modified       | æœªä¿®æ”¹     | **å¿«å–é©—è­‰**ã€‚è³‡æºå…§å®¹æ²’è®Šï¼Œè«‹ç€è¦½å™¨ç›´æ¥ç”¨æœ¬æ©Ÿå¿«å– (Status 200) çš„é‚£ä»½ã€‚                                                                                                                |
| **307** | Temporary Redirect | æš«æ™‚é‡å°å‘ | **æš«æ™‚æ€§æ¬å®¶ (åš´æ ¼è¦ç¯„)**ã€‚èˆ‡ 302 é¡ä¼¼ï¼Œä½†æ˜ç¢ºè¦ç¯„ï¼š**ä¸å¾—è®Šæ›´ HTTP Method èˆ‡ Body**ã€‚<br>âœ… _è‹¥ä½ åœ¨ 302 é‡åˆ° POST Body éºå¤±å•é¡Œï¼Œè«‹æ”¹ç”¨é€™å€‹(é€šå¸¸ç”¨æ–¼ 307 åˆ°å¦ä¸€å€‹ API)ã€‚_              |
| **308** | Permanent Redirect | æ°¸ä¹…é‡å°å‘ | **æ°¸ä¹…æ€§æ¬å®¶ (åš´æ ¼è¦ç¯„)**ã€‚èˆ‡ 301 é¡ä¼¼ï¼Œä½†æ˜ç¢ºè¦ç¯„ï¼š**ä¸å¾—è®Šæ›´ HTTP Method èˆ‡ Body**ã€‚<br>âœ… _æ¯” 301 æ›´ç¾ä»£çš„é¸æ“‡ï¼Œç¢ºä¿è½‰ç™¼è«‹æ±‚çš„å®Œæ•´æ€§ã€‚_                                              |

> **ğŸ“Œ 3xx é‡å°å‘ï¼šé¿å‘æŒ‡å—èˆ‡æœ€ä½³å¯¦è¸**
>
> **1. 302 vs 307 çš„å·®åˆ¥ï¼Ÿ**
> 302 æ˜¯èˆŠæ¨™æº–ï¼Œå®ƒçš„æ¨¡ç³Šå®šç¾©å°è‡´ç€è¦½å™¨å¯¦ä½œä¸ä¸€è‡´ï¼Œå¸¸æŠŠ `POST` å…¨éƒ¨è½‰æˆ `GET`ï¼Œå°è‡´ Form è¡¨å–®è³‡æ–™éºå¤±ã€‚
> **çµè«–ï¼š** å¦‚æœä½ çš„ API æ˜¯å…§éƒ¨è½‰ç™¼ (å¦‚ `/api/v1` -> `/api/v2`) ä¸”éœ€è¦ä¿ç•™ POST Bodyï¼Œ**è«‹å‹™å¿…ä½¿ç”¨ 307**ã€‚
>
> **2. é¸æ“‡åˆ¤æ–·æ–¹æ³•**
>
> - **Q1ï¼šè‹¥æ˜¯ã€ŒPOST æäº¤è¡¨å–®ã€å¾Œï¼Œè¦å°å»å¦ä¸€å€‹ç•«é¢çµ¦ä½¿ç”¨è€…å¯Ÿçœ‹çµæœï¼Ÿ**
>   ğŸ‘‰ **303 (See Other)**ï¼šé€™æ˜¯æœ€æ¨™æº–çš„ PRG (Post-Redirect-Get) æ¨¡å¼ï¼Œé˜²æ­¢ä½¿ç”¨è€… F5 é‡è¤‡é€å–®ã€‚
>   <br>
> - **Q2ï¼šè‹¥æ˜¯ã€ŒæŠ€è¡“æ€§è½‰ç™¼ã€ï¼Œä¸”å¿…é ˆä¿ç•™åŸæœ¬çš„ POST Bodyï¼Ÿ**
>   ğŸ‘‰ **307 (Temporary Redirect)**ï¼šæš«æ™‚è½‰ç™¼
>   ğŸ‘‰ **308 (Permanent Redirect)**ï¼šæ°¸ä¹…è½‰ç™¼
>   <br>
> - **Q3ï¼šè‹¥æ˜¯ã€Œç€è¦½å™¨å¿«å– (Cache)ã€æœ‰é—œï¼Ÿ**
>   ğŸ‘‰ **304 (Not Modified)**ï¼šæœªä¿®æ”¹
>   <br>
> - **Q4ï¼šè‹¥åªæ˜¯æš«æ™‚å°ä¸€ä¸‹ï¼Œä¸è€ƒæ…® POST Body çš„ä¿ç•™ï¼Ÿ**
>   ğŸ˜… **302 (Found)**ï¼šé›–ç„¶ä¸å®Œç¾ï¼Œä½†å®ƒæ˜¯ç›®å‰æœ€é€šç”¨çš„ã€Œæš«æ™‚æ¬å®¶ã€ã€‚

#### 4xx (å®¢æˆ¶ç«¯éŒ¯èª¤ - Client Error)

å•é¡Œå‡ºåœ¨ã€Œè«‹æ±‚æ–¹ã€(å‰ç«¯/ä½¿ç”¨è€…)ï¼ŒServer æ˜¯æ­£å¸¸çš„ã€‚

| ä»£ç¢¼    | å®šç¾©               | ä¸­æ–‡       | æƒ…å¢ƒèªªæ˜                                                                                             |
| :------ | :----------------- | :--------- | :--------------------------------------------------------------------------------------------------- |
| **400** | Bad Request        | éŒ¯èª¤çš„è«‹æ±‚ | **è«‹æ±‚æ ¼å¼éŒ¯èª¤**ã€‚<br>ğŸ’¡ _æƒ…å¢ƒï¼šå¿…å‚³åƒæ•¸æ¼äº†ã€JSON æ ¼å¼å£æ‰ã€‚_                                       |
| **401** | Unauthorized       | æœªæˆæ¬Š     | **æœªèªè­‰ (Who are you?)**ã€‚<br>ğŸ’¡ _æƒ…å¢ƒï¼šæœªç™»å…¥ã€Token éæœŸ/ç„¡æ•ˆã€‚_                                  |
| **403** | Forbidden          | ç¦æ­¢å­˜å–   | **æ¬Šé™ä¸è¶³ (I know you, but No)**ã€‚<br>ğŸ’¡ _æƒ…å¢ƒï¼šä¸€èˆ¬æœƒå“¡æƒ³é€²å¾Œå°ã€è©¦åœ–å­˜å–ä»–äººè¨‚å–®ã€‚_               |
| **404** | Not Found          | æ‰¾ä¸åˆ°     | **æ‰¾ä¸åˆ°è³‡æº**ã€‚<br>ğŸ’¡ _æƒ…å¢ƒï¼šID ä¸å­˜åœ¨ã€ç¶²å€æ‰“éŒ¯ã€‚_                                                 |
| **405** | Method Not Allowed | æ–¹æ³•ä¸å…è¨± | **æ–¹æ³•ä¸æ”¯æ´**ã€‚<br>ğŸ’¡ _æƒ…å¢ƒï¼šAPI åªå¯«äº† GETï¼Œä½ å»ç”¨ POST æ‰“é€²ä¾†ã€‚_                                  |
| **409** | Conflict           | è¡çª       | **è³‡æºè¡çª**ã€‚<br>ğŸ’¡ _æƒ…å¢ƒï¼šè¨»å†Šå·²å­˜åœ¨çš„å¸³è™Ÿã€ä½µç™¼ä¿®æ”¹ (ç·¨è¼¯æœŸé–“ï¼Œè³‡æ–™å·²è¢«ä»–äººæ›´æ–°ï¼Œå°è‡´æ›´æ–°å¤±æ•—)ã€‚_ |
| **429** | Too Many Requests  | è«‹æ±‚éå¤š   | **è«‹æ±‚éæ–¼é »ç¹**ã€‚                                                                                   |

#### 5xx (ä¼ºæœå™¨ç«¯éŒ¯èª¤ - Server Error)

å•é¡Œå‡ºåœ¨ã€Œæ”¶ä»¶äººã€(å¾Œç«¯/ä¼ºæœå™¨)ï¼Œå‰ç«¯åƒæ•¸æ²’éŒ¯ï¼Œæ˜¯æˆ‘å€‘æ›äº†ã€‚

| ä»£ç¢¼    | å®šç¾©                  | ä¸­æ–‡           | æƒ…å¢ƒèªªæ˜                                                                       |
| :------ | :-------------------- | :------------- | :----------------------------------------------------------------------------- |
| **500** | Internal Server Error | ä¼ºæœå™¨å…§éƒ¨éŒ¯èª¤ | **ä¼ºæœå™¨å…§éƒ¨éŒ¯èª¤**ã€‚<br>ğŸ’¡ _é è¨­éŒ¯èª¤ä»£ç¢¼ï¼Œè¡¨ç¤ºä½ æ²’æœ‰åšå¥½å¾Œç«¯éŒ¯èª¤åˆ†é¡_          |
| **502** | Bad Gateway           | éŒ¯èª¤çš„é–˜é“     | **é–˜é“éŒ¯èª¤**ã€‚<br>ğŸ’¡ _æƒ…å¢ƒï¼šNginx æ´»è‘—ï¼Œä½†å¾Œé¢çš„ App Server æ›äº†ã€‚_            |
| **503** | Service Unavailable   | æœå‹™ç„¡æ³•ä½¿ç”¨   | **æœå‹™æš«æ™‚ç„¡æ³•ä½¿ç”¨**ã€‚<br>ğŸ’¡ _æƒ…å¢ƒï¼šä¼ºæœå™¨éè¼‰ã€åœæ©Ÿç¶­è­·ä¸­ã€‚_                  |
| **504** | Gateway Timeout       | é–˜é“é€¾æ™‚       | **é–˜é“é€¾æ™‚**ã€‚<br>ğŸ’¡ _æƒ…å¢ƒï¼šNginx ç­‰ä¸åˆ°å¾Œç«¯ App Server çš„å›æ‡‰ (ç¨‹å¼è·‘å¤ªä¹…)ã€‚_ |

> **ğŸ’¡ è£œå……èªªæ˜ï¼šä»€éº¼æ˜¯ Nginxï¼Ÿ**
>
> Nginx æ˜¯ä¸€æ¬¾é«˜æ•ˆèƒ½çš„ **Web ä¼ºæœå™¨ (Web Server)** èˆ‡ **åå‘ä»£ç†ä¼ºæœå™¨ (Reverse Proxy)**ã€‚åœ¨ç¾ä»£å¾Œç«¯æ¶æ§‹ä¸­ï¼Œå®ƒé€šå¸¸æ‰®æ¼”ã€Œå®ˆé–€å“¡ã€çš„è§’è‰²ï¼š
>
> 1.  **åå‘ä»£ç†**ï¼šéš±è—å¾Œç«¯çœŸå¯¦ä¼ºæœå™¨çš„ IPï¼Œçµ±ä¸€ç”± Nginx æ¥æ”¶è«‹æ±‚å†è½‰ç™¼ï¼Œæå‡å®‰å…¨æ€§ã€‚
> 2.  **è² è¼‰å¹³è¡¡ (Load Balancing)**ï¼šå°‡å¤§é‡æµé‡å¹³å‡åˆ†é…çµ¦å¤šå°å¾Œç«¯ä¼ºæœå™¨ï¼Œé¿å…å–®ä¸€ä¼ºæœå™¨éè¼‰ã€‚
> 3.  **éœæ…‹è³‡æºè™•ç†**ï¼šç›´æ¥è™•ç†åœ–ç‰‡ã€CSSã€JS ç­‰æª”æ¡ˆï¼Œæ¸›è¼•å¾Œç«¯ç¨‹å¼ï¼ˆå¦‚ Java/Pythonï¼‰çš„è² æ“”ã€‚
> 4.  **SSL çµ‚æ­¢**ï¼šçµ±ä¸€åœ¨ Nginx å±¤è™•ç† HTTPS åŠ å¯†é€£ç·šï¼Œå¾Œç«¯ä¼ºæœå™¨åªéœ€è·‘ç°¡å–®çš„ HTTPã€‚
>
> ç•¶ä½ åœ¨ç‹€æ…‹ç¢¼çœ‹åˆ° **502 (Bad Gateway)** æˆ– **504 (Gateway Timeout)** æ™‚ï¼Œé€šå¸¸å°±æ˜¯ Nginx é€™å€‹ã€Œä¸­é–“äººã€é€£ä¸åˆ°å¾Œç«¯ç¨‹å¼ï¼Œæˆ–æ˜¯ç­‰å¾Œç«¯ç¨‹å¼è·‘å¤ªä¹…è€Œé€¾æ™‚ã€‚

> **ğŸ’¡ è£œå……èªªæ˜ï¼šæ­£å‘ä»£ç† vs åå‘ä»£ç†**
>
> å¾ˆå¤šäººæœƒææ··é€™å…©å€‹æ¦‚å¿µï¼Œç°¡å–®ä¾†èªªï¼Œå€åˆ¥åœ¨æ–¼ã€Œä»£ç†èª°ã€ï¼š
>
> 1.  **æ­£å‘ä»£ç† (Forward Proxy)**ï¼š
>
>     - **ä»£ç†å°è±¡**ï¼šå®¢æˆ¶ç«¯ (Client)ã€‚
>     - **æƒ…å¢ƒ**ï¼šä½ è¦ã€Œç¿»ç‰†ã€çœ‹å¤–éƒ¨ç¶²ç«™ï¼Œæˆ–æ˜¯å…¬å¸å…§éƒ¨é›»è…¦é€éä¸€å° Proxy ä¸Šç¶²ã€‚
>     - **ä½œç”¨**ï¼šéš±è—å®¢æˆ¶ç«¯çœŸå¯¦ IPã€ç¹éå­˜å–é™åˆ¶ã€‚ä¼ºæœå™¨åªçŸ¥é“ä»£ç†ä¼ºæœå™¨ä¾†æ‰¾å®ƒï¼Œä¸çŸ¥é“èƒŒå¾Œæ˜¯èª°ã€‚
>
> 2.  **åå‘ä»£ç† (Reverse Proxy)**ï¼š
>     - **ä»£ç†å°è±¡**ï¼šä¼ºæœå™¨ç«¯ (Server)ã€‚
>     - **æƒ…å¢ƒ**ï¼šNginx æ“‹åœ¨å¤šå° App Server å‰é¢ã€‚
>     - **ä½œç”¨**ï¼šéš±è—ä¼ºæœå™¨çœŸå¯¦ IPã€è² è¼‰å¹³è¡¡ã€SSL æ†‘è­‰ç®¡ç†ã€‚å®¢æˆ¶ç«¯åªçŸ¥é“ Nginxï¼Œä¸çŸ¥é“èƒŒå¾Œåˆ°åº•æ˜¯å“ªå°ä¼ºæœå™¨åœ¨è™•ç†ã€‚
>
> **ä¸€å¥è©±ç¸½çµï¼š** æ­£å‘ä»£ç†éš±è—ã€ŒçœŸæ­£çš„å®¢æˆ¶ç«¯ã€ï¼Œåå‘ä»£ç†éš±è—ã€ŒçœŸæ­£çš„ä¼ºæœå™¨ã€ã€‚

### 7. RESTful å…­å¤§ç´„æŸ

è¦ç¨±ç‚º RESTfulï¼Œå¿…é ˆç¬¦åˆä»¥ä¸‹åŸå‰‡ï¼š

1.  **Client-Server**ï¼šå‰å¾Œç«¯åˆ†é›¢ï¼Œå„å¸å…¶è·ã€‚
2.  **Stateless (ç„¡ç‹€æ…‹)**ï¼š**æœ€é‡è¦ï¼** ä¼ºæœå™¨ä¸ä¿å­˜ Client çš„ç‹€æ…‹ (Session)ï¼Œæ¯æ¬¡è«‹æ±‚éƒ½å¿…é ˆåŒ…å«æ‰€æœ‰é©—è­‰è³‡è¨Š (å¦‚ Token)ã€‚é€™è®“ä¼ºæœå™¨å®¹æ˜“æ“´å±•ã€‚
3.  **Cacheable (å¯å¿«å–)**ï¼šå›æ‡‰è¦æ¨™ç¤ºæ˜¯å¦å¯è¢«ç€è¦½å™¨æˆ– CDN å¿«å–ã€‚
4.  **Uniform Interface (çµ±ä¸€ä»‹é¢)**ï¼šURL å‘½åé¢¨æ ¼ä¸€è‡´ã€æ¨™æº–çš„ HTTP å‹•è©ã€‚
5.  **Layered System (åˆ†å±¤ç³»çµ±)**ï¼šClient ä¸æœƒçŸ¥é“æºé€šçš„ç›®æ¨™æ˜¯çœŸæ­£çš„ Serverï¼Œé‚„æ˜¯ä¸­é–“çš„ Load Balancer(åå‘ä»£ç†ä¼ºæœå™¨)ï¼Œçµæ§‹å¯ä»¥éš¨æ„æŠ½æ›ã€‚
6.  **Code on Demand (å¯é¸)**ï¼šServer å¯ä»¥å‚³é€å¯åŸ·è¡Œçš„ç¨‹å¼ç¢¼çµ¦ Client (å¦‚ JS)ï¼Œé€™é»ç¾åœ¨å·²ç¶“æ˜¯ Web æ¨™æº–äº†ã€‚

> **ğŸ’¡ æé†’ï¼š**
> RESTful æ˜¯ä¸€ç¨®æ¶æ§‹é¢¨æ ¼ï¼Œ**ä¸¦éå¼·åˆ¶æ€§çš„ç¡¬æ€§æ¨™æº–**ã€‚åœ¨å¯¦å‹™é–‹ç™¼ä¸­ï¼Œå®ƒåƒ…ä½œç‚ºè¨­è¨ˆå»ºè­°ï¼Œä¸éœ€è¦å®Œå…¨æ­»æ¿åœ°éµå¾ªï¼Œæ‡‰ä»¥æ¥­å‹™éœ€æ±‚èˆ‡åœ˜éšŠé–‹ç™¼æ•ˆç‡ç‚ºé¦–è¦è€ƒé‡ã€‚

### 8. å…¶ä»–é¢¨æ ¼ API è£œå……

REST é›–ç„¶æ˜¯ä¸»æµï¼Œä½†ä¸æ˜¯å”¯ä¸€ï¼š

- **GraphQL (Facebook)**ï¼š

  - **ç—›é»**ï¼šREST å¸¸æœ‰ "Over-fetching" (æ‹¿å¤ªå¤šä¸éœ€è¦çš„æ¬„ä½) æˆ– "Under-fetching" (è¦æ‰“å¥½å¹¾éš» API æ‰æ¹Šé½Šè³‡æ–™) çš„å•é¡Œã€‚
  - **ç‰¹è‰²**ï¼šåªæœ‰ä¸€å€‹ Endpoint (`/graphql`)ã€‚å‰ç«¯å¯ä»¥**è‡ªå·±å¯« Query èªè¨€**æ±ºå®šè¦æ‹¿ä»€éº¼æ¬„ä½ã€‚
  - **é©ç”¨**ï¼šå‰ç«¯éœ€æ±‚è®ŠåŒ–æ¥µå¿«ã€è³‡æ–™é—œè¯è¤‡é›œçš„æ‡‰ç”¨ã€‚
  - **ç¯„ä¾‹**ï¼š
    ```graphql
    # Client åªè¦é€™å…©å€‹æ¬„ä½ï¼ŒServer å°±åªæœƒå›å‚³é€™å…©å€‹
    query {
      user(id: 1) {
        name
        email
      }
    }
    ```

- **gRPC (Google)**ï¼š
  - **ç‰¹è‰²**ï¼šä½¿ç”¨ HTTP/2 + Protobuf (äºŒé€²åˆ¶æ ¼å¼)ã€‚æ¯” JSON è¼•é‡éå¸¸å¤šï¼Œé€Ÿåº¦æ¥µå¿«ã€‚
  - **é©ç”¨**ï¼šå¾®æœå‹™ (Microservices) ä¹‹é–“çš„å…§éƒ¨å‚³è¼¸ï¼Œè¦æ±‚æ¥µè‡´æ•ˆèƒ½çš„å ´æ™¯ã€‚
  - **ç¯„ä¾‹**ï¼š
    ```protobuf
    // é¡ä¼¼ Java classï¼Œä½†ç·¨è­¯å¾Œæ˜¯äºŒé€²åˆ¶å‚³è¼¸
    message User request {
      int32 id = 1;
      string name = 2;
    }
    ```

---

## <a id="CH3-2"></a>[3-2 è³‡æ–™å‚³è¼¸ç‰©ä»¶ (DTO) è§£æ](#toc)

åˆå­¸è€…æœ€æ„›çŠ¯çš„éŒ¯èª¤ï¼š**ç›´æ¥æŠŠ Entity (è³‡æ–™åº«ç‰©ä»¶) å›å‚³çµ¦å‰ç«¯**ã€‚

### ç‚ºä»€éº¼ä¸èƒ½ç”¨ Entityï¼Ÿ

1.  **å®‰å…¨æ€§ (Security)**ï¼š
    ä½ çš„ `User` Entity å¯èƒ½åŒ…å« `password`ã€`salt` ç­‰æ•æ„Ÿæ¬„ä½ã€‚è‹¥ç›´æ¥å›å‚³ Entityï¼ŒJackson æœƒæŠŠæ‰€æœ‰æ¬„ä½è½‰æˆ JSONï¼Œå°è‡´å¯†ç¢¼æˆ–å€‹è³‡å¤–æ´©ã€‚

    ```json
    // âŒ éŒ¯èª¤ç¤ºç¯„ï¼šç›´æ¥å›å‚³ Entity å°è‡´å¯†ç¢¼å¤–æ´©
    {
      "id": 1,
      "username": "admin",
      "password": "$2a$10$D8...", // ğŸ˜± å®Œè›‹äº†
      "createdAt": "2023-01-01"
    }
    ```

2.  **å¾ªç’°åƒç…§ (Circular Reference)**ï¼š
    JPA é—œè¯ä¸­å¸¸è¦‹é›™å‘åƒç…§ï¼ˆUser <-> Orderï¼‰ã€‚

    - User æœ‰ List<Order>
    - Order æœ‰ User
    - è½‰ JSON æ™‚æœƒè®Šæˆï¼š`User -> Order -> User -> Order ...` ç„¡é™è¿´åœˆï¼Œç›´åˆ°æ‹‹å‡º `StackOverflowError`ã€‚

3.  **è€¦åˆåº¦ (Coupling)**ï¼š
    å‰ç«¯éåº¦ä¾è³´è³‡æ–™åº«çµæ§‹ã€‚å¦‚æœä½ é…åˆæ¥­å‹™éœ€æ±‚ä¿®æ”¹äº† Table æ¬„ä½åç¨± (ä¾‹å¦‚ `phone` æ”¹æˆ `mobile`)ï¼Œå‰ç«¯ç¨‹å¼ç¢¼å°±æœƒå£æ‰ã€‚ä½¿ç”¨ DTO å¯ä»¥ä½œç‚ºä¸­é–“ç·©è¡å±¤ï¼Œä¿æŒ API ä»‹é¢ä¸è®Šã€‚

### DTO (Data Transfer Object) å¯¦æˆ°ç¯„ä¾‹

DTO æ˜¯ä¸€å€‹ç´”ç²¹çš„ POJO (Plain Old Java Object)ï¼Œè£¡é¢æ²’æœ‰å•†æ¥­é‚è¼¯ï¼Œåªæœ‰æ¬„ä½ã€‚å®ƒçš„å­˜åœ¨åªæœ‰ä¸€å€‹ç›®çš„ï¼š**å®šç¾©å‰å¾Œç«¯çš„è³‡æ–™å¥‘ç´„**ã€‚

é€šå¸¸æˆ‘å€‘æœƒå°‡ Request èˆ‡ Response åˆ†é–‹è¨­è¨ˆï¼š

#### 1. RequestDTO (æ¥æ”¶å‰ç«¯è³‡æ–™)

åªåŒ…å«ã€Œå…è¨±è¢«å‰ç«¯ä¿®æ”¹ã€çš„æ¬„ä½ï¼Œä¸”é€šå¸¸æœƒåŠ ä¸Šé©—è­‰è¨»è§£ (`@NotBlank`, `@Email`)ã€‚

```java
@Data
public class UserCreateRequest {

    @NotBlank(message = "ä½¿ç”¨è€…åç¨±ä¸å¾—ç‚ºç©º")
    private String username;

    @Email(message = "Email æ ¼å¼ä¸æ­£ç¢º")
    private String email;

    // å¯†ç¢¼åœ¨å‚³è¼¸æ™‚å­˜åœ¨ï¼Œä½†ä¸æœƒå­˜å…¥ ResponseDTO
    private String password;
}
```

#### 2. ResponseDTO (å›å‚³çµ¦å‰ç«¯)

åªåŒ…å«ã€Œå‰ç«¯é¡¯ç¤ºéœ€è¦ã€çš„æ¬„ä½ï¼Œå¯ä»¥éš±è—æ•æ„Ÿè³‡è¨Šï¼Œæˆ–æ˜¯çµ„åˆå¤šå€‹æ¬„ä½çš„è¨ˆç®—çµæœã€‚

```java
@Data
public class UserResponse {

    private Long id;
    private String username;
    private String email;

    // å¯ä»¥åœ¨é€™è£¡åšè³‡æ–™åŠ å·¥ï¼Œä¾‹å¦‚å°‡ LocalDateTime è½‰æˆ UNIX Timestampï¼Œæˆ–éš±è—ç§’æ•¸
    private String createdDate;

    // âŒ çµ•å°ä¸æ”¾ password
}
```

---

### æ‰‹å¯« Mapper (Manual Mapping)

åœ¨ä»‹ç´¹è‡ªå‹•åŒ–å·¥å…·ä¹‹å‰ï¼Œæˆ‘å€‘å…ˆçœ‹çœ‹æœ€åŸå§‹çš„ã€Œæ‰‹å¯«è½‰æ›ã€ã€‚é€™æ˜¯ç†è§£æ‰€æœ‰ Mapping å·¥å…·çš„åŸºç¤ã€‚

æˆ‘å€‘é€šå¸¸æœƒå¯«ä¸€å€‹ helper class æˆ–åœ¨ Service å±¤é€²è¡Œè½‰æ›ï¼š

```java
@Component
public class UserMapper {

    // Entity -> DTO
    public UserResponse toDto(User entity) {
        if (entity == null) return null;

        UserResponse dto = new UserResponse();
        dto.setId(entity.getId());
        dto.setUsername(entity.getUsername());
        dto.setEmail(entity.getEmail());
        // è‡ªå®šç¾©è½‰æ›é‚è¼¯
        dto.setCreatedDate(entity.getCreatedAt().toString());

        return dto;
    }

    // DTO -> Entity
    public User toEntity(UserCreateRequest request) {
        if (request == null) return null;

        User entity = new User();
        entity.setUsername(request.getUsername());
        entity.setEmail(request.getEmail());
        entity.setPassword(request.getPassword()); // å¯¦éš›å°ˆæ¡ˆæ‡‰åŠ å¯†

        return entity;
    }
}
```

**ä½¿ç”¨æ–¹å¼ (åœ¨ Service ä¸­)ï¼š**

```java
@Service
public class userService {

    @Autowired private UserMapper userMapper;
    @Autowired private UserRepository userRepository;

    public UserResponse getUser(Long id) {
        User user = userRepository.findById(id).orElseThrow();
        // è½‰æˆ DTO å†å›å‚³
        return userMapper.toDto(user);
    }
}
```

é›–ç„¶æ‰‹å¯« Mapper **é‚è¼¯æ¸…æ™°**ã€**é™¤éŒ¯ç°¡å–®**ï¼Œä½†ç•¶æ¬„ä½æœ‰ 50 å€‹çš„æ™‚å€™ï¼Œä½ æœƒå¯« `set` å¯«åˆ°æ‡·ç–‘äººç”Ÿã€‚é€™æ™‚å°±æ˜¯ **BeanUtils** æˆ– **MapStruct** ç™»å ´çš„æ™‚å€™äº†ã€‚

---

## <a id="CH3-3"></a>[3-3 ç‰©ä»¶è½‰æ›ç¥å™¨ï¼šBeanUtils vs MapStruct](#toc)

æœ‰äº† DTOï¼Œæˆ‘å€‘å°±æœƒé¢è‡¨ä¸€å€‹ç—›è‹¦çš„å•é¡Œï¼š**æ€éº¼æŠŠ Entity è½‰æˆ DTOï¼Ÿ**
æ‰‹å¯« `dto.setName(entity.getName())` å°±åƒä¸Šé¢ç¤ºç¯„çš„é‚£æ¨£ï¼Œå¯«åå€‹æ¬„ä½é‚„è¡Œï¼Œå¯«ä¸€ç™¾å€‹æœƒç˜‹æ‰ã€‚

### 1. Spring BeanUtils (ç°¡å–®ä½†æœ‰é›·)

Spring è‡ªå¸¶çš„å·¥å…·ã€‚

```java
import org.springframework.beans.BeanUtils;

// ä¾†æº, ç›®çš„
BeanUtils.copyProperties(userEntity, userDto);
```

- **å„ªé»**ï¼šä¸ç”¨å¤šå¯« codeï¼Œåªè¦æ¬„ä½åä¸€æ¨£å°±èƒ½è½‰ã€‚
- **ç¼ºé»**ï¼š
  - **æ•ˆèƒ½è¼ƒå·®**ï¼šå› ç‚ºæ˜¯ç”¨ Reflection (åå°„) åœ¨åŸ·è¡ŒæœŸé–“å‹•æ…‹çŒœæ¬„ä½ã€‚
  - **é™¤éŒ¯å›°é›£**ï¼šæ¬„ä½å¡«éŒ¯åå­—ä¸æœƒå ±éŒ¯ï¼Œåªæœƒè®Šæˆ nullã€‚
  - **æ·±æ‹·è²å•é¡Œ**ï¼šå°æ–¼ List æˆ–å·¢ç‹€ç‰©ä»¶è™•ç†å¾ˆå¼±ã€‚

### 2. MapStruct (æ¨è–¦)

MapStruct æ˜¯ä¸€å€‹ **Annotation Processor**ï¼Œæ˜¯ç›®å‰æ¥­ç•Œæœ€æ¨è–¦çš„ Java Bean Mapping å·¥å…·ã€‚å®ƒèˆ‡ BeanUtils æœ€å¤§çš„å€åˆ¥åœ¨æ–¼ï¼š

1.  **ç·¨è­¯æ™‚æœŸ (Compile Time) ç”Ÿæˆç¨‹å¼ç¢¼**ï¼šå®ƒä¸æ˜¯é åå°„ (Reflection) åœ¨åŸ·è¡ŒæœŸé–“çŒœæ¸¬ï¼Œè€Œæ˜¯åƒä½ æ‰‹å¯«ä¸€æ¨£ï¼Œç›´æ¥åœ¨ç·¨è­¯æ™‚å¹«ä½ å¯«å¥½ `setXxx(getXxx())` çš„ç¨‹å¼ç¢¼ã€‚
2.  **æ•ˆèƒ½æ¥µè‡´**ï¼šå› ç‚ºæ˜¯ç´” Getter/Setterï¼Œé€Ÿåº¦è·Ÿæ‰‹å¯«ä¸€æ¨¡ä¸€æ¨£ï¼Œæ¯” BeanUtils å¿«ä¸Šæ•¸åå€ã€‚
3.  **é™¤éŒ¯å®¹æ˜“**ï¼šå¦‚æœæ¬„ä½åç¨±å°ä¸ä¸Šï¼Œç·¨è­¯ç›´æ¥å ±éŒ¯ï¼Œä¸æœƒç­‰åˆ° Runtime æ‰å™´ NullPointerExceptionã€‚ç”Ÿæˆçš„ç¨‹å¼ç¢¼ä¹Ÿè®€å¾—æ‡‚ã€‚

> **ğŸ’¡ çŸ¥è­˜å°ç™¾ç§‘ï¼šä»€éº¼æ˜¯ Java åå°„ (Reflection)ï¼Ÿ**
>
> åå°„æ˜¯ Java æä¾›çš„ä¸€ç¨®æ©Ÿåˆ¶ï¼Œå…è¨±ç¨‹å¼åœ¨ **åŸ·è¡ŒæœŸé–“ (Runtime)** å‹•æ…‹åœ°ç²å–é¡åˆ¥çš„å…§éƒ¨è³‡è¨Šï¼ˆå¦‚é¡åˆ¥åç¨±ã€å±¬æ€§ã€æ–¹æ³•ã€å»ºæ§‹å­ï¼‰ä¸¦é€²è¡Œæ“ä½œï¼Œç”šè‡³å¯ä»¥å­˜å– `private` æˆå“¡ã€‚
>
> - **å„ªé»**ï¼šæ¥µé«˜çš„éˆæ´»æ€§ã€‚è¨±å¤šæ¡†æ¶ï¼ˆå¦‚ Spring çš„ä¾è³´æ³¨å…¥ã€Hibernateã€JUnitï¼‰éƒ½å¤§é‡ä½¿ç”¨åå°„ä¾†å¯¦ç¾é€šç”¨åŠŸèƒ½ã€‚
> - **ç¼ºé»**ï¼š
>   - **æ•ˆèƒ½æè€—**ï¼šå› ç‚ºæ˜¯åœ¨ Runtime æ™‚å‹•æ…‹è§£æï¼ŒJVM ç„¡æ³•å°å…¶é€²è¡Œé ç·¨è­¯å„ªåŒ–ï¼Œé€Ÿåº¦æ¯”ç›´æ¥å‘¼å«ç¨‹å¼ç¢¼æ…¢ã€‚
>   - **é¡å‹å®‰å…¨é¢¨éšª**ï¼šç·¨è­¯å™¨ç„¡æ³•åœ¨ç·¨è­¯æ™‚æª¢æŸ¥å‡ºåå°„èª¿ç”¨çš„éŒ¯èª¤ï¼Œå¿…é ˆç­‰åˆ°åŸ·è¡Œæ™‚æ‰æœƒç™¼ç¾ã€‚
>
> é€™ä¹Ÿæ˜¯ç‚ºä»€éº¼ **MapStruct** è¢«èªç‚ºå„ªæ–¼ **BeanUtils** çš„ä¸»å› ï¼šMapStruct æ£„ç”¨åå°„ï¼Œæ”¹åœ¨ç·¨è­¯æ™‚æœŸç›´æ¥ç”Ÿæˆç´” Java çš„ Getter/Setter ä»£ç¢¼ã€‚

#### æ­¥é©Ÿä¸€ï¼šå¼•å…¥ä¾è³´ (Maven)

âš ï¸ **æ³¨æ„ï¼šå¦‚æœä½ åŒæ™‚ä½¿ç”¨ Lombokï¼Œå¿…é ˆç‰¹åˆ¥æ³¨æ„ `annotationProcessorPaths` çš„é †åºï¼** Lombok å¿…é ˆå…ˆè™•ç†ï¼ŒMapStruct æ‰èƒ½è®€åˆ° Getter/Setterã€‚

```xml
<properties>
    <org.mapstruct.version>1.5.5.Final</org.mapstruct.version>
    <org.projectlombok.version>1.18.30</org.projectlombok.version>
</properties>

<dependencies>
    <dependency>
        <groupId>org.mapstruct</groupId>
        <artifactId>mapstruct</artifactId>
        <version>${org.mapstruct.version}</version>
    </dependency>
    <!-- Lombok ä¾è³´é€šå¸¸å·²ç¶“æœ‰äº† -->
</dependencies>

<build>
    <plugins>
        <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-compiler-plugin</artifactId>
            <version>3.8.1</version>
            <configuration>
                <source>17</source>
                <target>17</target>
                <annotationProcessorPaths>
                    <!-- 1. å¿…é ˆæŠŠ Lombok æ”¾åœ¨å‰é¢ -->
                    <path>
                        <groupId>org.projectlombok</groupId>
                        <artifactId>lombok</artifactId>
                        <version>${org.projectlombok.version}</version>
                    </path>
                    <!-- 2. Lombok èˆ‡ MapStruct çš„é»åˆåŠ‘ (è§£æ±º Builder æ¨¡å¼è¡çª) -->
                    <path>
                        <groupId>org.projectlombok</groupId>
                        <artifactId>lombok-mapstruct-binding</artifactId>
                        <version>0.2.0</version>
                    </path>
                    <!-- 3. æœ€å¾Œæ‰æ˜¯ MapStruct -->
                    <path>
                        <groupId>org.mapstruct</groupId>
                        <artifactId>mapstruct-processor</artifactId>
                        <version>${org.mapstruct.version}</version>
                    </path>
                </annotationProcessorPaths>
            </configuration>
        </plugin>
    </plugins>
</build>
```

#### æ­¥é©ŸäºŒï¼šå®šç¾©ä»‹é¢ (Mapper Interface)

ä½ åªéœ€è¦å®šç¾© Interfaceï¼Œå¯¦ä½œé¡åˆ¥æœƒç”± MapStruct è‡ªå‹•ç”¢ç”Ÿ (é€šå¸¸å« `UserMapperImpl`)ã€‚

```java
@Mapper(componentModel = "spring") // é‡è¦ï¼šåŠ ä¸Šé€™è¡Œï¼ŒMapStruct æœƒè‡ªå‹•åŠ ä¸Š @Componentï¼Œè®“ä½ èƒ½åœ¨ Service æ³¨å…¥
public interface UserMapper {

    // 1. Entity -> DTO
    // åªè¦æ¬„ä½åç¨±ä¸€æ¨£ï¼Œæœƒè‡ªå‹•å°æ‡‰ã€‚ä¹Ÿèƒ½è‡ªå‹•è½‰å‹ (å¦‚ int -> String, Date -> String)
    UserDto toDto(User entity);

    // 2. DTO -> Entity
    User toEntity(UserCreateRequest dto);

    // 3. List è½‰æ›
    // MapStruct æœƒè‡ªå‹•ç”¢ç”Ÿè¿´åœˆï¼Œå‘¼å«ä¸Šé¢çš„å–®é«”è½‰æ›æ–¹æ³•
    List<UserDto> toDtoList(List<User> list);
}
```

#### æ­¥é©Ÿä¸‰ï¼šé€²éšå°æ‡‰ (`@Mapping`)

ç•¶æ¬„ä½åç¨±ä¸åŒï¼Œæˆ–æ˜¯éœ€è¦ç‰¹å®šé‚è¼¯æ™‚ï¼š

```java
// unmappedTargetPolicy = ReportingPolicy.IGNORE : å¿½ç•¥é‚£äº›æ²’å°æ‡‰åˆ°çš„æ¬„ä½è­¦å‘Š (è®“ Console ä¹¾æ·¨é»)
@Mapper(componentModel = "spring", unmappedTargetPolicy = ReportingPolicy.IGNORE)
public interface OrderMapper {

    @Mapping(source = "createdDate", target = "orderDate", dateFormat = "yyyy-MM-dd") // 1. æ ¼å¼åŒ–æ—¥æœŸ
    @Mapping(source = "user.name", target = "customerName") // 2. å·¢ç‹€å–å€¼ (Deep Mapping)
    @Mapping(target = "internalCode", ignore = true)        // 3. å¿½ç•¥ç‰¹å®šç›®æ¨™æ¬„ä½
    @Mapping(target = "statusLabel", expression = "java(mapStatus(order.getStatus()))") // 4. ä½¿ç”¨ Java è¡¨é”å¼ (é›–ç„¶å¼·å¤§ä½†å»ºè­°å°‘ç”¨ï¼Œæ”¹ç”¨ä¸‹é¢çš„ default method)
    OrderDto toDto(Order order);

    // å¯ä»¥åœ¨ Interface è£¡å¯« default method æä¾›ç°¡å–®é‚è¼¯ï¼ŒMapStruct æœƒè‡ªå‹•å¼•ç”¨
    default String mapStatus(Integer status) {
        return status != null && status == 1 ? "Paid" : "Unpaid";
    }
}
```

#### æ­¥é©Ÿå››ï¼šæ›´æ–°ç¾æœ‰ç‰©ä»¶ (`@MappingTarget`)

é€™æ˜¯ **PUT (Update)** æ“ä½œæ™‚çš„ç¥å™¨ã€‚ä½ éœ€è¦æŠŠ DTO çš„æ–°å€¼è“‹æ‰ Entity çš„èˆŠå€¼ï¼Œä½†ä¸æƒ³ `new` ä¸€å€‹æ–°çš„ Entity (å› ç‚ºè¦ä¿ç•™ ID å’Œ JPA ç‹€æ…‹)ã€‚

```java
@Mapper(componentModel = "spring")
public interface UserMapper {

    // æŠŠ dto çš„å…§å®¹ï¼Œæ›´æ–°åˆ°ã€Œç¾æœ‰çš„ã€entity ç‰©ä»¶ä¸­ (void å›å‚³å³å¯)
    // åªæœ‰ dto é null çš„æ¬„ä½æœƒè¢«è¤‡è£½éå» (éœ€é…åˆ NullValuePropertyMappingStrategy)
    void updateEntity(UserUpdateRequest dto, @MappingTarget User entity);
}
```

#### æ­¥é©Ÿäº”ï¼šè¤‡é›œé‚è¼¯ (`@AfterMapping`)

å¦‚æœæœ‰æ›´è¤‡é›œç„¡æ³•ç”¨è¨­å®šå®Œæˆçš„é‚è¼¯ (ä¾‹å¦‚æ¬„ä½ä¾è³´)ï¼Œå¯ä»¥ç”¨ abstract class æˆ–æ˜¯ `@AfterMapping`ã€‚

```java
@Mapper(componentModel = "spring")
public abstract class UserMapper {

    // å¿…é ˆå®£å‘Šæˆ abstract class æ‰èƒ½å¯«å¯¦ä½œ
    public abstract UserDto toDto(User entity);

    // é€™å€‹æ–¹æ³•æœƒåœ¨ toDto ä¸»é‚è¼¯è·‘å®Œå¾Œï¼Œè‡ªå‹•è¢«å‘¼å«
    @AfterMapping
    protected void afterToDto(User entity, @MappingTarget UserDto dto) {
        // Ex: åªæœ‰åœ¨æŸäº›æ¢ä»¶ä¸‹æ‰è¨­å®šæ•æ„Ÿè³‡è¨Š
        if (entity.getAge() >= 18) {
            dto.setIsAdult(true);
        }

        // Ex: çµ„åˆæ¬„ä½
        dto.setFullName(entity.getFirstName() + " " + entity.getLastName());
    }
}
```

#### ğŸ’¡ å¸¸è¦‹å•é¡Œèˆ‡é™¤éŒ¯

1.  **ç·¨è­¯å¤±æ•—ï¼Œæ‰¾ä¸åˆ° MapperImplï¼Ÿ**
    - æª¢æŸ¥ `pom.xml` çš„ `maven-compiler-plugin` è¨­å®šã€‚Lombok å¿…é ˆåœ¨ MapStruct **ä¹‹å‰**ã€‚
    - å¦‚æœä½ ç”¨ IDE (å¦‚ IntelliJ)ï¼Œæœ‰æ™‚éœ€ Enable Annotation Processingã€‚
2.  **DTO åŠ äº† `@Data` (Lombok) å»æœ‰äº›æ¬„ä½æ²’å€¼ï¼Ÿ**
    - MapStruct é è¨­ç”¨ Setter å¯«å…¥ã€‚ç¢ºä¿ä½ çš„ Lombok `@Data` æœ‰æ­£å¸¸é‹ä½œã€‚
    - å¦‚æœæ˜¯ Builder æ¨¡å¼ (`@Builder`)ï¼Œè¨˜å¾—åŠ  `lombok-mapstruct-binding` ä¾è³´ã€‚
3.  **æ€éº¼çœ‹å®ƒåˆ°åº•è½‰äº†ä»€éº¼ï¼Ÿ**
    - MapStruct æ˜¯ç”ŸæˆåŸå§‹ç¢¼ã€‚å»å°ˆæ¡ˆçš„ `/target/generated-sources/annotations/` è³‡æ–™å¤¾ä¸‹ï¼Œç›´æ¥é»é–‹ `UserMapperImpl.java` ä¾†çœ‹ï¼Œä¸€åˆ‡çœŸç›¸å¤§ç™½ã€‚

---

## <a id="CH3-4"></a>[3-4 æ¥æ”¶èˆ‡å›æ‡‰è³‡æ–™çš„åå…«èˆ¬æ­¦è— (Frontend & Backend)](#toc)

å¾Œç«¯ Controller è¦æ€éº¼æ¥å‰ç«¯ä¸Ÿéä¾†çš„æ±è¥¿ï¼Ÿé€™å–æ±ºæ–¼ HTTP Header ä¸­çš„ `Content-Type`ã€‚æˆ‘å€‘ä¾†çœ‹çœ‹å¸¸è¦‹çš„äº”ç¨®æƒ…å¢ƒï¼Œä¸¦é™„ä¸Š **Frontend (Axios)** èˆ‡ **Backend (Spring Boot)** çš„å°ç…§å¯«æ³•ã€‚

### 1. JSON è³‡æ–™ (`application/json`)

é€™æ˜¯ç¾ä»£ Ajax æœ€æ¨™æº–çš„å‚³è¼¸æ–¹å¼ã€‚

- **å‰ç«¯**ï¼šå‚³é€ JS ç‰©ä»¶ï¼Œaxios æœƒè‡ªå‹•è½‰ç‚º JSON å­—ä¸²ã€‚
- **å¾Œç«¯**ï¼šä½¿ç”¨ `@RequestBody` æ¥æ”¶ï¼ŒSpring æœƒè‡ªå‹•ååºåˆ—åŒ–ç‚º Java Beanã€‚

#### Frontend (Axios)

```javascript
// axios é è¨­ Content-Type å°±æ˜¯ application/json
axios.post("/api/products", {
  name: "iPhone 15",
  price: 29900,
  tags: ["Apple", "Mobile"],
});
```

#### Backend (Spring Boot)

```java
@PostMapping("/api/products")
public ResponseEntity<Product> create(@RequestBody ProductDto dto) {
    // dto.getName() -> "iPhone 15"
    // dto.getTags() -> List<String>
    return ResponseEntity.ok(productService.save(dto));
}
```

---

### 2. URL åƒæ•¸ (`Path Variables` & `Query Parameters`)

é€™é€šå¸¸ç”¨æ–¼ `GET` è«‹æ±‚ï¼Œæˆ–æ˜¯åˆªé™¤/ä¿®æ”¹ç‰¹å®š ID çš„è³‡æºã€‚

#### A. è·¯å¾‘åƒæ•¸ (Path Variable)

ç”¨ä¾†è­˜åˆ¥ç‰¹å®šè³‡æº (ex: ID)ã€‚

- **Frontend**: `` `/api/users/${id}` ``
- **Backend**: `@PathVariable`

```javascript
// å‰ç«¯
const userId = 101;
axios.get(`/api/users/${userId}`);
```

```java
// å¾Œç«¯
@GetMapping("/api/users/{id}")
public UserDto getUser(@PathVariable Long id) {
    return userService.findById(id);
}
```

#### B. æŸ¥è©¢åƒæ•¸ (Query String)

ç”¨ä¾†ç¯©é¸ã€æœå°‹æˆ–åˆ†é ã€‚

- **Frontend**: ä½¿ç”¨ `params` ç‰©ä»¶ã€‚
- **Backend**: `@RequestParam`

```javascript
// å‰ç«¯ -> å¯¦éš›ç™¼å‡º: /api/orders?status=PAID&page=1
axios.get("/api/orders", {
  params: {
    status: "PAID",
    page: 1,
  },
});
```

```java
// å¾Œç«¯ - å¯«æ³• 1ï¼šé€å€‹æ¥æ”¶
@GetMapping("/api/orders")
public List<OrderDto> getOrders(
    @RequestParam String status,
    @RequestParam(defaultValue = "1") int page
) {
    // ...
}

// å¾Œç«¯ - å¯«æ³• 2ï¼šç”¨ DTO ä¸€æ¬¡æ¥å®Œ (@ModelAttribute) (æ¨è–¦)
// åªè¦ DTO å±¬æ€§åç¨±è·Ÿ Query String å°ä¸Šï¼Œå°±æœƒè‡ªå‹•è£å…¥
@GetMapping("/api/orders/advanced")
public List<OrderDto> getOrders(@ModelAttribute OrderSearchQuery query) {
    // query.getStatus(), query.getPage()
    return orderService.search(query);
}
```

---

### 3. è¡¨å–®è³‡æ–™ (`application/x-www-form-urlencoded`)

é€™ä¸»è¦æœ‰å…©ç¨®å ´æ™¯ï¼š

1.  å‚³çµ± `<form>` æäº¤ã€‚
2.  ä¸²æ¥èˆŠå¼ API (é JSON æ ¼å¼)ã€‚

- **å‰ç«¯**ï¼šä½¿ç”¨ `URLSearchParams`ã€‚
- **å¾Œç«¯**ï¼šä½¿ç”¨ `@RequestParam` æˆ– `@ModelAttribute` (âŒ **åƒè¬åˆ¥åŠ  @RequestBody**)ã€‚

#### Frontend (Axios)

```javascript
// å¿…é ˆç”¨ URLSearchParamsï¼Œaxios æ‰æœƒé€å‡º form-urlencoded æ ¼å¼
const params = new URLSearchParams();
params.append("username", "allen");
params.append("password", "123456");

axios.post("/api/login", params);
```

#### Backend (Spring Boot)

```java
@PostMapping("/api/login")
public String login(
    @RequestParam String username, // ä¹Ÿå¯ä»¥ç”¨ String password
    LoginRequest request           // æˆ–ç›´æ¥ç”¨ç‰©ä»¶æ¥ (çœç•¥ @ModelAttribute)
) {
    // request.getUsername() -> "allen"
    return "Login Success";
}
```

---

### 4. æª”æ¡ˆä¸Šå‚³ (`multipart/form-data`)

é€™ä¹Ÿæ˜¯ Ajax ä¸­è¼ƒç‚ºç‰¹æ®Šçš„æƒ…å¢ƒï¼Œå¿…é ˆä½¿ç”¨ `FormData` ç‰©ä»¶ã€‚

- **å‰ç«¯**ï¼šä½¿ç”¨ `FormData` ç‰©ä»¶ã€‚å»ºç«‹å¾Œ `append` æª”æ¡ˆã€‚
- **å¾Œç«¯**ï¼šä½¿ç”¨ `MultipartFile` æ¥æ”¶æª”æ¡ˆã€‚

#### Frontend (Axios)

```javascript
/* HTML: <input type="file" id="fileInput"> */
const fileInput = document.getElementById("fileInput");
const file = fileInput.files[0];

const formData = new FormData();
formData.append("file", file);
formData.append("description", "My Avatar");

axios.post("/api/upload", formData, {
  headers: {
    "Content-Type": "multipart/form-data",
    // å…¶å¯¦ axios åµæ¸¬åˆ° FormData æœƒè‡ªå‹•åŠ é€™å€‹ header ä¸¦é™„ä¸Š boundaryï¼Œä½†æ˜ç¢ºå¯«å‡ºä¾†æ˜¯å¥½ç¿’æ…£ã€‚
  },
});
```

#### Backend (Spring Boot)

```java
@PostMapping("/api/upload")
public String upload(
    @RequestParam("file") MultipartFile file,
    @RequestParam("description") String description
) throws IOException {

    // 1. æª¢æŸ¥æ˜¯å¦ç‚ºç©º
    if (file.isEmpty()) throw new RuntimeException("æª”æ¡ˆä¸èƒ½ç‚ºç©º");

    // 2. å­˜æª” (ç¯„ä¾‹å­˜åˆ° C:/uploads)
    File dest = new File("C:/uploads/" + file.getOriginalFilename());
    if (!dest.getParentFile().exists()) {
        dest.getParentFile().mkdirs(); // è‡ªå‹•å»ºç«‹è³‡æ–™å¤¾
    }
    file.transferTo(dest); // å¯«å…¥ç£ç¢Ÿ

    return "Upload Success";
}
```

---

### 5. æª”æ¡ˆä¸‹è¼‰ (`Blob`)

ä¸‹è¼‰çš„ç—›é»åœ¨æ–¼ï¼šå¦‚æœå¾Œç«¯å›å‚³äºŒé€²ä½æµï¼Œè€Œä½ ç”¨ä¸€èˆ¬çš„æ–¹å¼æ¥ï¼Œæœƒè®Šæˆä¸€å †äº‚ç¢¼å­—ä¸²ã€‚å› ç‚º Ajax é è¨­æ˜¯è™•ç†æ–‡å­—çš„ã€‚

- **å‰ç«¯**ï¼šå¿…é ˆæŒ‡å®š `responseType: 'blob'`ã€‚
- **å¾Œç«¯**ï¼šå›å‚³ `ResponseEntity<Resource>` ä¸¦è¨­å®šæ­£ç¢ºçš„ Content-Typeã€‚

#### Frontend (Axios)

```javascript
async function downloadImage() {
  try {
    const res = await axios.get("/api/download/cat.jpg", {
      responseType: "blob", // é—œéµï¼å‘Šè¨´ Axios ä¸è¦è½‰æ–‡å­—ï¼Œçµ¦æˆ‘äºŒé€²ä½ç‰©ä»¶
    });

    // æŠ€å·§ï¼šå‰µé€ ä¸€å€‹æš«æ™‚çš„ URL æŒ‡å‘é€™å€‹ Blob
    const url = window.URL.createObjectURL(new Blob([res.data]));

    // 1. å¦‚æœæ˜¯è¦é¡¯ç¤ºåœ–ç‰‡
    document.getElementById("img-preview").src = url;

    // 2. å¦‚æœæ˜¯è¦è§¸ç™¼ç€è¦½å™¨ä¸‹è¼‰
    const link = document.createElement("a");
    link.href = url;
    link.setAttribute("download", "cat.jpg"); // è¨­å®šä¸‹è¼‰æª”å
    document.body.appendChild(link);
    link.click();
    link.remove(); // ä¸‹è¼‰å®Œç§»é™¤é€£çµ

    // é‡‹æ”¾è¨˜æ†¶é«”
    window.URL.revokeObjectURL(url);
  } catch (err) {
    console.error("ä¸‹è¼‰å¤±æ•—", err);
  }
}
```

#### Backend (Spring Boot)

```java
@GetMapping("/api/download/{filename}")
public ResponseEntity<Resource> download(@PathVariable String filename) throws MalformedURLException {

    Path path = Paths.get("C:/uploads/" + filename);
    Resource resource = new UrlResource(path.toUri());

    // è¨­å®š Header å‘Šè¨´ç€è¦½å™¨é€™æ˜¯è¦ä¸‹è¼‰çš„ (attachment)
    String headerValue = "attachment; filename=\"" + resource.getFilename() + "\"";

    return ResponseEntity.ok()
            .contentType(MediaType.IMAGE_JPEG) // æˆ– MediaType.APPLICATION_OCTET_STREAM
            .header(HttpHeaders.CONTENT_DISPOSITION, headerValue)
            .body(resource);
}
```

### ç¸½çµå°ç…§è¡¨

| è³‡æ–™é¡å‹          | Content-Type               | å‰ç«¯ (Axios)             | å¾Œç«¯ (Spring Annotations)            |
| :---------------- | :------------------------- | :----------------------- | :----------------------------------- |
| **JSON**          | `application/json`         | `{ name: 'A' }`          | `@RequestBody ProductDto dto`        |
| **URL Path**      | N/A                        | `` `/api/${id}` ``       | `@PathVariable Long id`              |
| **Query String**  | N/A                        | `{ params: { q: 'A' } }` | `@RequestParam String q`             |
| **Form Data**     | `x-www-form-urlencoded`    | `new URLSearchParams()`  | `@RequestParam` / `@ModelAttribute`  |
| **File Upload**   | `multipart/form-data`      | `new FormData()`         | `@RequestParam("f") MultipartFile f` |
| **File Download** | `application/octet-stream` | `responseType: 'blob'`   | `ResponseEntity<Resource>`           |

ä¸‹ä¸€ç« ï¼Œæˆ‘å€‘å°‡é€²å…¥å…¨ç«¯é–‹ç™¼çš„æ·±æ°´å€ï¼š**Web å®‰å…¨æ€§èˆ‡ Vue.js æ•´åˆ**ã€‚
